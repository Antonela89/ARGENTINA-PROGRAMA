!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("hivemindSdk",[],e):"object"==typeof exports?exports.hivemindSdk=e():t.hivemindSdk=e()}(window,function(){return r={},i.m=n=[function(t,e,n){"use strict";n.d(e,"o",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"e",function(){return a}),n.d(e,"c",function(){return s}),n.d(e,"b",function(){return c}),n.d(e,"j",function(){return u}),n.d(e,"l",function(){return l}),n.d(e,"m",function(){return f}),n.d(e,"t",function(){return p}),n.d(e,"i",function(){return d}),n.d(e,"k",function(){return v}),n.d(e,"s",function(){return g}),n.d(e,"r",function(){return m}),n.d(e,"q",function(){return y}),n.d(e,"p",function(){return b}),n.d(e,"d",function(){return S}),n.d(e,"g",function(){return T}),n.d(e,"f",function(){return E}),n.d(e,"n",function(){return O}),n.d(e,"h",function(){return _});var r=n(7);function i(t,e){return!(!u(t)||!u(e))&&t.slice(0,e.length)===e}function o(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return!(!u(t)||!u(e))&&(n&&(t=t.toLowerCase(),e=e.toLowerCase()),t.slice(t.length-e.length)===e)}function a(t,e,n){var r=n;try{var i=e.split("."),o=t;i.forEach(function(t){return o=o[t]}),void 0!==o&&(r=o)}catch(t){}return r}function s(t,e){if(Array.isArray(t)&&"function"==typeof e)for(var n=0;n<t.length;n++)if(!0===e(t[n],n,t))return n;return-1}function c(t,e){var n;if(d(t))for(var r=Object.keys(t),i=0;i<r.length&&!n;i++){var o=r[i];e(t[o],o,t)&&(n=t[o])}else if(Array.isArray(t))for(var a=0;a<t.length&&!n;a++){e(t[a],a,t)&&(n=t[a])}return n}function u(t){return"string"==typeof t||t instanceof String}function l(t){return t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&(Number.isFinite?Number.isFinite(t):isFinite(t))}function f(t){return t instanceof Number&&(t=t.valueOf()),t!=t}var h=-1;function p(){return h++}function d(t){return t&&"object"===Object(r.a)(t)&&t.constructor===Object}function v(t,n){var r=t;d(n)&&Object.keys(n).forEach(function(t){var e=n[t];d(e)&&(e=r[t]&&d(r[t])?v({},r[t],e):v({},e)),void 0!==e&&(r[t]=e)});for(var e=arguments.length,i=new Array(2<e?e-2:0),o=2;o<e;o++)i[o-2]=arguments[o];if(i&&i.length){var a=i.splice(0,1)[0];r=v.apply(void 0,[r,a].concat(i))}return r}function g(t){var e={};return t.filter(function(t){return!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=!0)})}function m(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:JSON.stringify,r={};return t.filter(function(t){var e=n(t);return!Object.prototype.hasOwnProperty.call(r,e)&&(r[e]=!0)})}function y(t){if(null==t)return"";if("string"==typeof t)return t;if(Array.isArray(t))return t.map(function(t){return u(t)?t:""})+"";var e=t+"";return"0"==e&&1/t===Number.NEGATIVE_INFINITY?"-0":e}function b(t){if("number"==typeof t)return t;if(d(t)&&"function"==typeof t.valueOf){var e=t.valueOf();t=d(e)?e+"":e}return"string"!=typeof t?0===t?t:+t:+(t=t.replace(/^\s+|\s+$/g,""))}function S(e,n){return Object.keys(e).forEach(function(t){return n(e[t],t,e)}),e}function T(t,e){var n={};if(Array.isArray(t)&&u(e))for(var r=0;r<t.length;r++){var i=t[r][e];u(i)&&(n[i]||(n[i]=[]),n[i].push(t[r]))}return n}function E(t){return t.name?t.name:(t.toString().match(/function (.+?)\(/)||["",""])[1]}function O(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n}function _(t){return!0===t||!1===t}},function(t,f,h){"use strict";(function(t){h.d(f,"a",function(){return l});function e(e){return!!Object(i.b)(r.a,function(t){return e===t})}var r=h(6),n=h(9),i=h(0),o={showLevel:!0,displayAllErrors:!1},a=!1;void 0!==t&&void 0!==t.version&&t.version&&(a=!0);function s(t,e){var n=1<arguments.length&&void 0!==e?e:{};return new r.b(t,Object(i.k)(n,o))}var c=String(a?t.env.SPLITIO_DEBUG:Object(n.a)()?localStorage.getItem("splitio_debug"):""),u=s("splitio-utils:logger"),l={enable:function(){Object(r.c)(r.a.DEBUG)},setLogLevel:function(t){e(t)?Object(r.c)(t):u.error("Invalid Log Level - No changes to the logs will be applied.")},disable:function(){Object(r.c)(r.a.NONE)},LogLevel:r.a};/^(enabled?|on)/i.test(c)?l.enable(r.a.DEBUG):e(c)?l.setLogLevel(c):l.disable(),f.b=s}).call(this,h(31))},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var c=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,r,i=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))u.call(n,a)&&(i[a]=n[a]);if(c){r=c(n);for(var s=0;s<r.length;s++)l.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i}},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";var r=n(10),i=r.idTypes,o=r.PARAMETER_LABEL,a=r.DEFAULT_COHORT,s=n(18),c=s.validateApp,u=s.updateCohortAllocationsWithEid,l=s.generateDefaultAllocations,f=s.groupEligibleExperimentsById,h=n(19),p=h.getSubjectKey,d=h.getCohortId,v=h.getSubjectIdType,g=h.treatmentsToCohortAllocations,m=h.transformSplitToExperiment,y=n(23);t.exports={hivemindConstants:{idTypes:i,PARAMETER_LABEL:o,DEFAULT_COHORT:a},MockWrapper:y,validateApp:c,updateCohortAllocationsWithEid:u,generateDefaultAllocations:l,groupEligibleExperimentsById:f,getSubjectKey:p,getCohortId:d,getSubjectIdType:v,treatmentsToCohortAllocations:g,transformSplitToExperiment:m}},function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"c",function(){return u}),n.d(e,"b",function(){return f});var r=n(2),i=n(4),o=n(3),a=n.n(o),s={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},c=s.DEBUG,u=function(t){c=t},l={showLevel:!0,displayAllErrors:!1},f=function(){function n(t,e){Object(r.a)(this,n),this.category=t,this.options=a()({},l,e)}return Object(i.a)(n,[{key:"debug",value:function(t){this._shouldLog(s.DEBUG)&&this._log(s.DEBUG,t)}},{key:"info",value:function(t){this._shouldLog(s.INFO)&&this._log(s.INFO,t)}},{key:"warn",value:function(t){this._shouldLog(s.WARN)&&this._log(s.WARN,t)}},{key:"error",value:function(t){(this.options.displayAllErrors||this._shouldLog(s.ERROR))&&this._log(s.ERROR,t)}},{key:"_log",value:function(t,e){var n=this._generateLogMessage(t,e);console.log(n)}},{key:"_generateLogMessage",value:function(t,e){var n="";return this.options.showLevel&&(n+="["+t+"]"+(t===s.INFO||t===s.WARN?" ":"")+" "),this.category&&(n+=this.category+" => "),n+e}},{key:"_shouldLog",value:function(t){var e=c,n=Object.keys(s).map(function(t){return s[t]}),r=n.indexOf(t);return n.indexOf(e)<=r}}]),n}()},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,l=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(i,o){return new Promise(function(t,e){function n(){void 0!==r&&i.removeListener("error",r),t([].slice.call(arguments))}var r;"error"!==o&&(r=function(t){i.removeListener(o,n),e(t)},i.once("error",r)),i.once(o,n)})},(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function f(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function c(t,e,n,r){var i,o,a,s;if(u(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),0<(i=f(t))&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return t}function h(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(r);return i.listener=n,r.wrapFn=i}function p(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):v(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return f(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(0<e.length&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[t];if(void 0===s)return!1;if("function"==typeof s)l(s,this,e);else{var c=s.length,u=v(s,c);for(n=0;n<c;++n)l(u[n],this,e)}return!0},a.prototype.on=a.prototype.addListener=function(t,e){return c(this,t,e,!1)},a.prototype.prependListener=function(t,e){return c(this,t,e,!0)},a.prototype.once=function(t,e){return u(e),this.on(t,h(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,h(this,t,e)),this},a.prototype.off=a.prototype.removeListener=function(t,e){var n,r,i,o,a;if(u(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;0<=o;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},a.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;0<=r;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return p(this,t,!0)},a.prototype.rawListeners=function(t){return p(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},function(t,e,n){"use strict";function r(){var t="__SPLITSOFTWARE__";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}}n.d(e,"a",function(){return r})},function(t,e){t.exports={idTypes:{SHOPPER_ID:"shopperId",VISITOR_GUID:"visitorGuid"},DEFAULT_COHORT:"ineligible",PARAMETER_LABEL:"parameter"}},function(t,e,n){"use strict";e.__esModule=!0,e._setWindow=e._setNavigator=e._setDocument=e._getWindowEvent=e._getEventElement=e._getClickCoordinates=e._findPosY=e._findPosX=e.parseCookie=e.getPromoEventData=e.isSupported=e.isCorporateHost=e.iterateAncestors=e.isValidHrefElement=e.getWindow=e.getNavigator=e.getHost=e.getDocument=e.getClickEventData=e.getBaseHost=e.getAttributeFromElement=e.formatPageName=void 0;var r,i=n(24),o=(r=i)&&r.__esModule?r:{default:r},l=n(12);function a(){return p.window}function f(){return p.document}var s,c,u,h,p=(s="",c=Object.create({get cookie(){return s},set cookie(t){s=t}}),u={document:c},h={},"undefined"==typeof window?{window:u,document:c,navigator:h}:{window:window||u,document:window.document||c,navigator:navigator||h});function d(){return p.navigator}function v(){var t=a().location;return t&&t.hostname?t.hostname:""}function g(t){var e=v();t&&o.default.isSet(t)&&(e=o.default.get(t));var n=e.split(".");return 2<=n.length&&(e=n.slice(n.length-2).join(".")),e}function m(t,e,n){if(n&&n.clientX&&n.clientY&&n.pageX&&n.pageY){var r={};if(t&&e&&-1!==e.userAgent.indexOf("MSIE")){var i="CSS1Compat"===t.compatMode?t.documentElement:t.body;r.pagex=Math.round(n.clientX+(i.scrollLeft?i.scrollLeft:0)),r.pagey=Math.round(n.clientY+(i.scrollTop?i.scrollTop:0))}else r.pagex=Math.round(n.pageX),r.pagey=Math.round(n.pageY);return r.clientx=Math.round(n.clientX),r.clienty=Math.round(n.clientY),r}}function y(t){var e=0;if(t.offsetParent)for(;t.offsetParent;)e+=t.offsetLeft,t=t.offsetParent;else t.x&&(e+=t.x);return e}function b(t){var e=0;if(t.offsetParent)for(;t.offsetParent;)e+=t.offsetTop,t=t.offsetParent;else t.y&&(e+=t.y);return e}function S(t,e,n){var r=n||1;if(e&&!(10<r)){var i=t(e);return!i&&e.parentNode?S(t,e.parentNode,r+1):i}}function T(){return a().event}function E(){var t=T();if(null!=t){var e=t.target||t.srcElement;if(null!=e)return e.nodeType&&3===e.nodeType&&(e=e.parentNode),e}}function O(t,e){if(t&&t.attributes&&t.attributes[e]&&t.attributes[e].value)return t.attributes[e].value}function _(t){var e=t.nodeName;return"A"===e||"AREA"===e}e.formatPageName=function(t){return"string"!=typeof t||void 0===t||""===t?"notspecified":(t.lastIndexOf("/")===t.length-1&&(t=t.substring(0,t.length-1)),0!==t.indexOf("/")&&(t="/"+t),t)},e.getAttributeFromElement=O,e.getBaseHost=g,e.getClickEventData=function(t,e){var n=f(),r=d(),i=e||T(),o=t||E(),s={};if(o){s.type=o.type,s.eventid=o.id,s.eventclass=o.className,s.eventname=o.name,S(function(t){var e=O(t,"data-tcode"),n=O(t,"data-tdata"),r=O(t,"data-ci"),i=O(t,"data-tms"),o=O(t,"data-eid");o=(o=o||O(t,"data-e_id"))||O(t,"e_id");var a=void 0;if(_(t)&&(a=O(t,"href")),e||n||r||i||o||a)return e&&(s.tcode=e),n&&(s.usrin=n),r&&(s.ci=r),i&&(s.tms=i),o&&(s.e_id=o),a&&(s.href=a),s},o);var a=m(n,r,i);if(a)s.absolutex=a.pagex,s.absolutey=a.pagey,s.relativex=a.clientx,s.relativey=a.clienty;else{var c=y(o),u=b(o);s.absolutex=c,s.absolutey=u,s.relativex=c,s.relativey=u}}return(0,l.removeUndefined)(s),s},e.getDocument=f,e.getHost=v,e.getNavigator=d,e.getWindow=a,e.isValidHrefElement=_,e.iterateAncestors=S,e.isCorporateHost=function(t){var e=t||g();return 0<=e.indexOf("godaddy.com")||0<=e.indexOf("secureserver.net")},e.isSupported=function(){var t=d().userAgent.toLowerCase();return!/msie [1-8]\./.test(t)},e.getPromoEventData=function(t){var e=t||E(),i={},n={schema:"data-schema",id:"data-promo-id",name:"data-promo-name",creative_name:"data-creative-name",creative_slot:"data-creative-slot"};return e&&S(function(r){(0,l.map)(n,function(t,e){var n=O(r,e);n&&!i[t]&&(i[t]=n)}),_(r)&&(i.href=O(r,"href"))},e),i},e.parseCookie=function(t){for(var e=t.split(";"),n=Object.create(null),r=0;r<e.length;r++){var i=/([^=]*)*=([\s\S]*)/.exec(e[r]);if(i&&i[2]){var o=i[1].trim(),a=decodeURIComponent(i[2].trim());n[o]=a}}return n},e._findPosX=y,e._findPosY=b,e._getClickCoordinates=m,e._getEventElement=E,e._getWindowEvent=T,e._setDocument=function(t){var e=t||{};p.window.document=e,p.document=e},e._setNavigator=function(t){p.navigator=t||{}},e._setWindow=function(t){p.window=t||{}}},function(t,e,n){"use strict";e.__esModule=!0;function a(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=t[n];try{if(e(n,r))return t}catch(t){}}return t}function s(t){if(2===t.length)return t[1]}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=arguments;e.cleanKeyNames=function(r,i,o){r&&i&&a(r,function(t,e){var n=(t+"").split(i).join(o||"");delete r[t],r[n]=e})},e.map=a,e.merge=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r={},i=0;i<u.length;i++){var o=e[i];"object"===(void 0===o?"undefined":c(o))&&a(o,function(t,e){r[t]=e})}return r},e.parseString=function(t,e,n){if("string"!=typeof t)return{};for(var r={},i=t.split(e),o=0;o<i.length;o++){var a=i[o].split(n);r[a[0]]=s(a)}return r},e.parseValue=s,e.stringify=function(t,e,n){var r=[];return a(t,function(t,e){r.push(""+t+n+e)}),0===r.length?"":r.join(e)},e.removeUndefined=function(t){for(var e in t)void 0===t[e]&&delete t[e]}},function(t,e,n){"use strict";e.__esModule=!0,e._cryptOrUndefined=e._getDelegationClaims=e._getInfoTokenClaim=e._getInfoTokenClaims=e.getUserId=e.updateAuthTokens=e.isEmployee=e.isDelegated=e.isAuthenticated=e.getShopperId=e.getUserRealm=e.getCustomerId=e.getFederationPartnerId=e.getEmployeeId=e.getDelegateEmployeeId=e.getDelegateCustomerId=e.getClaimFromInfoToken=void 0;function o(t){return Object.keys(t).length<1}function a(t){var e={},n="info_"+t,r=(0,f.findCookie)(n);if(r)try{e=JSON.parse(r)}catch(t){}return e}function s(){return!o(p)}function r(t){return"del"in t?r(t.del):t}function c(t,e){return t?e?(0,h.sha256)(e):void 0:e}function i(t,e){if(s()&&"basic"!==p.auth){var n=r(p);return c(e,n[t])}}function u(t){return i(v.jomax,t)}function l(t,e,n){var r=t.typ;if(void 0===n||!r||r===n){var i=void 0,o=t.auth;if(o&&"basic"!==o)i=l(t[o],e,n);else i=t[e];return i}}var f=n(14),h=n(26),p={},d=["idp","jomax"],v={idp:"info_shopperId",jomax:"info_accountName"};e.getClaimFromInfoToken=function(t){if(s())return l(p,t)},e.getDelegateCustomerId=function(t){return i("info_cid",t)},e.getDelegateEmployeeId=u,e.getEmployeeId=function(t){if(s()){var e=p.typ,n=p.auth,r=v.jomax;if(e&&"jomax"===e)return c(t,p[r]);if(n&&"basic"!==n&&"e"===n.charAt(0))return u(t);var i=a("jomax");if(!o(i))return c(t,i[r])}},e.getFederationPartnerId=function(){if(s()){var t=l(p,"fpid");if(!t){var e=p.typ;void 0!==e&&(t=(0,f.findCookie)("brand_"+e))}return t}},e.getCustomerId=function(t){if(s())return c(t,l(p,"info_cid"))},e.getUserRealm=function(){if(s())return p.typ},e.getShopperId=function(t){if(s()&&"idp"===p.typ)return c(t,l(p,"info_shopperId"))},e.isAuthenticated=s,e.isDelegated=function(){if(!s())return!1;var t=p.auth;return t&&"basic"!==t},e.isEmployee=function(){if(!s())return!1;var t=p.typ,e=p.auth;if(t&&"jomax"===t)return!0;if(e&&"basic"!==e&&"e"===e.charAt(0))return!0;var n=a("jomax");return!o(n)},e.updateAuthTokens=function(){for(var t={},e=0;e<d.length;e++){var n=a(d[e]);!o(n)&&(o(t)||t.iat<n.iat)&&(t=n)}p=t},e.getUserId=function(t){if(s()){var e=p.typ;return c(t,l(p,v[e]))}},e._getInfoTokenClaims=a,e._getInfoTokenClaim=l,e._getDelegationClaims=r,e._cryptOrUndefined=c},function(t,e,n){"use strict";e.__esModule=!0,e._resetCookieCache=e._notifyWatchers=e.watchCookie=e.setCookie=e.getCookieValues=e.getCookieValue=e.getCookieObj=e.getCookieKeys=e.findCookie=e.checkCookiesEnabled=void 0;function r(t,e,n,r){var i=new Date;i.setTime(i.getTime()+60*n*1e3),(0,s.getDocument)().cookie=t+"="+encodeURI(e)+"; domain="+(0,s.getBaseHost)()+(n?"; expires="+i.toGMTString():"")+(r?"; path="+r:"")}function i(t){var e=(0,s.getDocument)().cookie;return u!==e&&(l=(0,s.parseCookie)(e),u=e),l[t]}function o(t){var e=i(t);return(0,c.parseString)(e,"&","=")}function a(){for(var t=0;t<p.length;t++)try{!0===p[t]()&&p.splice(t,1)}catch(t){continue}}var s=n(11),c=n(12),u=void 0,l=void 0,f=void 0,h=void 0,p=[];e.checkCookiesEnabled=function(t){var e=!!t.cookieEnabled;return void 0!==t.cookieEnabled||e||(r((0,s.getDocument)(),"testcookie"),e=-1!==(0,s.getDocument)().cookie.indexOf("testcookie")),e},e.findCookie=i,e.getCookieKeys=function(){for(var t=[],e=(0,s.getDocument)().cookie.split(";"),n=0;n<e.length;n++){var r=e[n].split("=")[0];""!==r&&t.push(r.trim())}return t},e.getCookieObj=function(t){var e=i(t);try{return e=JSON.parse(e)}catch(t){return}},e.getCookieValue=function(t,e){var n=o(t);if(n.hasOwnProperty(e))return n[e]},e.getCookieValues=o,e.setCookie=r,e.watchCookie=function(t){!0!==t()&&(p.push(t),1===p.length&&(h=setInterval(function(){f!==(0,s.getDocument)().cookie&&(f=(0,s.getDocument)().cookie,a()),0===p.length&&clearInterval(h)},200)))},e._notifyWatchers=a,e._resetCookieCache=function(){u=void 0,l=Object.create(null)}},function(t,e,n){"use strict";e.__esModule=!0,e.getVisitorId=void 0;var r=n(14),i=n(27);e.getVisitorId=function(){var t=function(){var t=(0,r.getCookieValues)("visitor");if(t)return t.vid}();return t||(0,i.debug)("A user identifier was unable to be retrived"),t}},function(t,e,n){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=((r=n(30))&&r.__esModule?r:{default:r}).default;e.default=i},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(t){return typeof t}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e.exports.default=e.exports,e.exports.__esModule=!0,n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(t,e,n){"use strict";function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var o=n(10).DEFAULT_COHORT;t.exports={validateApp:function(){if(!(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").match(/^[a-z0-9_-]+$/))throw new Error("Parameter 'app' must match regex '/^[a-z0-9_-]+$/'")},updateCohortAllocationsWithEid:function(n,r){return Object.keys(n).forEach(function(t){var e=n[t].error?"error":n[t].cohortId;n[t].eid="hivemind.".concat(r,".experiment.").concat(t,".").concat(e,".impression")}),n},generateDefaultAllocations:function(t){return t.reduce(function(t,e){return Object.assign(t,(i={cohortId:o,data:{}},(r=e)in(n={})?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n));var n,r,i},{})},groupEligibleExperimentsById:function(t){var o=t.subject,e=t.experiments,n=t.experimentsMetadata,a=e.filter(function(t){return!(t in n)});return{experimentsByIdType:Object.entries(n).reduce(function(t,e){var n=s(e,2),r=n[0],i=n[1];return o[i.subjectIdType]?(t[i.subjectIdType]||(t[i.subjectIdType]=[]),t[i.subjectIdType].push(r)):a.push(r),t},{}),ineligibleExperiments:a}}}},function(t,e,n){"use strict";var a=n(20).unflatten,r=n(10),i=r.idTypes,o=r.DEFAULT_COHORT,s=n(22).sha256;function c(t){return"control"===t?o:t}function u(t){switch(t){case"shopper":return i.SHOPPER_ID;case"visitor":return i.VISITOR_GUID;default:return t}}t.exports={getCohortId:c,getSubjectKey:function(t){var e=t.id;switch(t.idType){case i.SHOPPER_ID:return s(e);case i.VISITOR_GUID:return e;default:throw new Error("Invalid subject idType")}},getSubjectIdType:u,treatmentsToCohortAllocations:function(i){var o={};return Object.keys(i).forEach(function(t){var e=i[t],n=e.treatment,r=e.config;o[t]={cohortId:c(n),error:"control"===n,data:a(JSON.parse(r)||{})}}),o},transformSplitToExperiment:function(n){var t={experimentId:n.name,subjectIdType:u(n.trafficType),killed:n.killed,cohorts:n.treatments,cohortData:Object.keys(n.configs).reduce(function(t,e){return t[e]=a(JSON.parse(n.configs[e])||{}),t},{})},e=Object.values(t.cohortData).find(function(t){return t.labels});return t.labels=e?e.labels:[],t}}},function(t,e,n){var d=n(21);function r(t,l){var f=(l=l||{}).delimiter||".",h=l.maxDepth,p={};return function a(s,c,u){u=u||1,Object.keys(s).forEach(function(t){var e=s[t],n=l.safe&&Array.isArray(e),r=Object.prototype.toString.call(e),i=d(e),o=c?c+f+t:t;if(!n&&!i&&("[object Object]"===r||"[object Array]"===r)&&Object.keys(e).length&&(!l.maxDepth||u<h))return a(e,o,u+1);p[o]=e})}(t),p}((t.exports=r).flatten=r).unflatten=function s(c,u){u=u||{};var l=u.delimiter||".";var f=u.overwrite||!1;var h={};var t=d(c);if(t||"[object Object]"!==Object.prototype.toString.call(c))return c;function p(t){var e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||u.object?t:e}var e=Object.keys(c).sort(function(t,e){return t.length-e.length});e.forEach(function(t){for(var e=t.split(l),n=p(e.shift()),r=p(e[0]),i=h;void 0!==r;){var o=Object.prototype.toString.call(i[n]),a="[object Object]"===o||"[object Array]"===o;if(!f&&!a&&void 0!==i[n])return;(f&&!a||!f&&null==i[n])&&(i[n]="number"!=typeof r||u.object?{}:[]),i=i[n],0<e.length&&(n=p(e.shift()),r=p(e[0]))}i[n]=s(c[t],u)});return h}},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(n(t)||"function"==typeof(e=t).readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))||!!t._isBuffer);var e}},function(t,e){t.exports={sha256:function(t){function k(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function A(t,e){return t>>>e|t<<32-e}function w(t,e){return t>>>e}return function(t){for(var e="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return n}(function(t,e){var n,r,i,o,a,s,c,u,l,f,h,p,d,v,g,m,y,b,S,T,E=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],O=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],_=new Array(64);for(t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e,l=0;l<t.length;l+=16){for(n=O[0],r=O[1],i=O[2],o=O[3],a=O[4],s=O[5],c=O[6],u=O[7],f=0;f<64;f++)_[f]=f<16?t[f+l]:k(k(k((T=_[f-2],A(T,17)^A(T,19)^w(T,10)),_[f-7]),(S=_[f-15],A(S,7)^A(S,18)^w(S,3))),_[f-16]),h=k(k(k(k(u,A(b=a,6)^A(b,11)^A(b,25)),(y=a)&s^~y&c),E[f]),_[f]),p=k(A(m=n,2)^A(m,13)^A(m,22),(d=n)&(v=r)^d&(g=i)^v&g),u=c,c=s,s=a,a=k(o,h),o=i,i=r,r=n,n=k(h,p);O[0]=k(n,O[0]),O[1]=k(r,O[1]),O[2]=k(i,O[2]),O[3]=k(o,O[3]),O[4]=k(a,O[4]),O[5]=k(s,O[5]),O[6]=k(c,O[6]),O[7]=k(u,O[7])}return O}(function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):(127<r&&r<2048?e+=String.fromCharCode(r>>6|192):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128)),e+=String.fromCharCode(63&r|128))}return e}(t)),8*t.length))}}},function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function n(t){var e=t.mockData;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this._mockData=e}var t,e,r;return t=n,(e=[{key:"ready",get:function(){return Promise.resolve()}},{key:"getCohortAllocations",value:function(t){var s=t.experiments,e=this._mockData.cohorts;return Object.entries(e).reduce(function(t,e){var n=c(e,2),r=n[0],i=n[1];if(s.includes(r)){var o=i.data,a=i.cohortId;t[r]={data:o,cohortId:a}}return t},{})}},{key:"getExperimentsById",value:function(n){var r=this,t=this._mockData.cohorts;return Object.keys(t).reduce(function(t,e){return n.includes(e)&&Object.assign(t,r._getExperimentById(e)),t},{})}},{key:"getExperiments",value:function(){var n=this,t=this._mockData.cohorts;return Object.keys(t).reduce(function(t,e){return Object.assign(t,n._getExperimentById(e))},{})}},{key:"_getExperimentById",value:function(t){var e=this._mockData.cohorts,n=e[t].cohortId,r=e[t].data||{};return i({},t,{experimentId:t,subjectIdType:e[t].subjectType,killed:!1,cohorts:[n],cohortData:i({},n,r),labels:r.labels||[]})}}])&&o(t.prototype,e),r&&o(t,r),n}();t.exports=a},function(t,e,n){"use strict";e.__esModule=!0;var r,i=n(25);var o=new((r=i)&&r.__esModule?r:{default:r}).default;e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(12);var r=(o.prototype.clear=function(){this.properties={}},o.prototype.get=function(t){if(this.properties.hasOwnProperty(t))return this.properties[t]},o.prototype.set=function(t,e){this.properties[t]=e},o.prototype.isSet=function(t){if(this.properties.hasOwnProperty(t))return!0},o.prototype.delete=function(t){delete this.properties[t]},o.prototype.getProperties=function(t){var n={},r=function(){return!1};return t||"function"!=typeof t||(r=t),(0,i.map)(this.properties,function(t,e){r(t)||(n[t]=e)}),n},o.prototype.merge=function(t){var n=this,e=t;e instanceof o&&(e=t.getProperties()),(0,i.map)(e,function(t,e){n.set(t,e)})},o);function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.properties=t||{}}e.default=r},function(t,e,n){"use strict";e.__esModule=!0;e.sha256=function(t){function k(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function A(t,e){return t>>>e|t<<32-e}function w(t,e){return t>>>e}return function(t){for(var e="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return n}(function(t,e){var n,r,i,o,a,s,c,u,l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],h=new Array(64),p=void 0,d=void 0,v=void 0,g=void 0,m=void 0,y=void 0,b=void 0,S=void 0,T=void 0,E=void 0,O=void 0,_=void 0;for(t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e,T=0;T<t.length;T+=16){for(p=f[0],d=f[1],v=f[2],g=f[3],m=f[4],y=f[5],b=f[6],S=f[7],E=0;E<64;E++)h[E]=E<16?t[E+T]:k(k(k((u=h[E-2],A(u,17)^A(u,19)^w(u,10)),h[E-7]),(c=h[E-15],A(c,7)^A(c,18)^w(c,3))),h[E-16]),O=k(k(k(k(S,A(s=m,6)^A(s,11)^A(s,25)),(a=m)&y^~a&b),l[E]),h[E]),_=k(A(o=p,2)^A(o,13)^A(o,22),(n=p)&(r=d)^n&(i=v)^r&i),S=b,b=y,y=m,m=k(g,O),g=v,v=d,d=p,p=k(O,_);f[0]=k(p,f[0]),f[1]=k(d,f[1]),f[2]=k(v,f[2]),f[3]=k(g,f[3]),f[4]=k(m,f[4]),f[5]=k(y,f[5]),f[6]=k(b,f[6]),f[7]=k(S,f[7])}return f}(function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):(127<r&&r<2048?e+=String.fromCharCode(r>>6|192):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128)),e+=String.fromCharCode(63&r|128))}return e}(t)),8*t.length))}},function(t,e,n){"use strict";e.__esModule=!0,e._errorInit=e._logInit=e.error=e.info=e.debug=e.log=void 0;function r(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(0,a.getWindow)().console;return!(0,o.isProduction)()&&r&&r.log?Function.prototype.bind?Function.prototype.bind.call(r.log,r):function(){Function.prototype.apply.call(r.log,r,e)}:function(){}}function i(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(0,a.getWindow)().console;return!(0,o.isProduction)()&&r&&r.error?Function.prototype.bind?Function.prototype.bind.call(r.error,r):function(){Function.prototype.apply.call(r.error,r,e)}:function(){}}var o=n(28),a=n(11),s=r(),c=i();e.log=s,e.debug=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];(0,o.isDebug)()&&s.apply(null,e)},e.info=s,e.error=c,e._logInit=r,e._errorInit=i},function(t,e,n){"use strict";e.__esModule=!0,e.getEnvName=e.setDebug=e.isTest=e.isProduction=e.isDevelopment=e.isDebug=void 0;function r(t){var e=(0,a.getBaseHost)(t);return!e||(0,s.startsWith)(e,"dev-")||(0,s.startsWith)(e,"localhost")||(0,s.startsWith)(e,"dev.")||(0,s.startsWith)(e,"test.")}function i(t){var e=(0,a.getBaseHost)(t);return(0,s.startsWith)(e,"test-")||(0,s.startsWith)(e,"stg-")}function o(){return!r()&&!i()}var a=n(11),s=n(29),c=!1;e.isDebug=function(){return c},e.isDevelopment=r,e.isProduction=o,e.isTest=i,e.setDebug=function(t){c=!0===t||"true"===t},e.getEnvName=function(){return i()?"test":o()?"prod":"dev"}},function(t,e,n){"use strict";e.__esModule=!0;e.endsWith=function(t,e,n){return(void 0===n||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e},e.pad=function(t,e){if(void 0===t)return t;void 0===e&&(e=2);for(var n=String(t);n.length<e;)n="0"+n;return n},e.stringifyArray=function(t,e,n){for(var r="",i=0;i<(t.length<e?t.length:e);i++)r+=n(t[i])+"^";return r.substring(0,r.length-1)},e.startsWith=function(t,e,n){return t.substr(!n||n<0?0:+n,e.length)===e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.serializedData,n=void 0===e?{}:e,r=t.userId,i=void 0===r?"":r,o=t.storagePrefix,a=void 0===o?"":o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.localStorage,c=a?"".concat(a,".").concat(y):y,u="".concat(c,".splits.till");if(0===Object.keys(n).length)return;var l=n.segmentsData,f=void 0===l?{}:l,h=n.since,p=void 0===h?0:h,d=n.splitsData,v=void 0===d?{}:d,g=n.usingSegmentsCount,m=void 0===g?0:g;if(p<=s.getItem(u))return;b({windowLocalStorage:s,localStoragePrefix:c});try{s.setItem(u,p),Object.keys(v).forEach(function(t){s.setItem("".concat(c,".split.").concat(t),v[t])}),s.setItem("".concat(c,".splits.usingSegments"),m),Object.keys(f).forEach(function(t){var e="".concat(i,".").concat(c,".segment.").concat(t);JSON.parse(f[t]).added.includes(i)&&"1"!==s.getItem(e)&&s.setItem(e,"1")})}catch(t){console.error("Error setting localstorage",t),b({windowLocalStorage:s,localStoragePrefix:c})}},e.cleanLocalStorage=b;var y="SPLITIO";function b(t){var e=t.windowLocalStorage,n=void 0===e?window.localStorage:e,r=t.localStoragePrefix;Object.keys(n).forEach(function(t){t.includes(r)&&n.removeItem(t)})}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&p())}function p(){if(!l){var t=s(h);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||l||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e),n.d(e,"hivemindConstants",function(){return y.hivemindConstants}),n.d(e,"getClient",function(){return la});var y=n(5),m=n(13),b=n(15),r=n(16),u=n.n(r);function g(t){var e=t.app,n=t.idType,r=t.id,i=t.preloadLocation,o=void 0===i?"__splitCachePreload":i,a=t.windowOverride,s=void 0===a?window:a,c=t.loadData;return(void 0===c?u.a:c)({serializedData:s[o],userId:Object(y.getSubjectKey)({idType:n,id:r}),storagePrefix:"".concat(e)}),!!s[o]}var i=n(3),j=n.n(i),S=function(t){return null!=t&&"function"==typeof t.then},R=n(0),T=n(1),E=Object(T.b)("",{displayAllErrors:!0}),O={};function C(t){O[t]&&O[t]--,0===O[t]&&delete O[t]}var f=Object(T.b)("");var o=Object(T.b)(""),a=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/;function _(t,e){if(null==t)o.error("".concat(e,": you passed a null or undefined event_type, event_type must be a non-empty string."));else if(Object(R.j)(t))if(0===t.length)o.error("".concat(e,": you passed an empty event_type, event_type must be a non-empty string."));else{if(a.test(t))return t;o.error("".concat(e,': you passed "').concat(t,'", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'))}else o.error("".concat(e,": you passed an invalid event_type, event_type must be a non-empty string."));return!1}var s=Object(T.b)("");function k(t,e){return Object(R.l)(t)||null==t?t:(s.error("".concat(e,": value must be a finite number.")),!1)}var h=Object(T.b)(""),p={NULL:0,STRING:2,BOOLEAN:4,NUMBER:8},d=300,v=32768,A=1024;function w(t,e){if(null==t)return{properties:null,size:A};if(!Object(R.i)(t))return h.error("".concat(e,": properties must be a plain object.")),{properties:!1,size:A};var n=Object.keys(t),r=Object(R.n)(t),i={properties:r,size:A};n.length>d&&h.warn("".concat(e,": Event has more than 300 properties. Some of them will be trimmed when processed."));for(var o=0;o<n.length;o++){i.size+=n[o].length*p.STRING;var a=r[n[o]],s=Object(R.j)(a),c=Object(R.l)(a),u=Object(R.h)(a),l=null===a;if(s||c||u||l||(l=!(a=r[n[o]]=null),h.warn("".concat(e,": Property ").concat(n[o]," is of invalid type. Setting value to null."))),l?i.size+=p.NULL:c?i.size+=p.NUMBER:u?i.size+=p.BOOLEAN:s&&(i.size+=a.length*p.STRING),i.size>v){h.error("".concat(e,": The maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued.")),i.properties=!1;break}}return i}var c=Object(T.b)(""),l=250;function N(t,e,n){if(null==t)return c.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string.")),!1;if(Object(R.l)(t))return c.warn("".concat(e,": ").concat(n,' "').concat(t,'" is not of type string, converting.')),Object(R.q)(t);if(Object(R.j)(t)){if(0<(t=t.trim()).length&&t.length<=l)return t;0===t.length?c.error("".concat(e,": you passed an empty string, ").concat(n," must be a non-empty string.")):t.length>l&&c.error("".concat(e,": ").concat(n," too long, ").concat(n," must be 250 characters or less."))}else c.error("".concat(e,": you passed an invalid ").concat(n," type, ").concat(n," must be a non-empty string."));return!1}function I(t,e){if(Object(R.i)(t)){var n=N(t.matchingKey,e,"matchingKey"),r=N(t.bucketingKey,e,"bucketingKey");return n&&r?{matchingKey:n,bucketingKey:r}:(c.error("".concat(e,": Key must be an object with bucketingKey and matchingKey with valid string properties.")),!1)}return N(t,e,"key")}var D="definition not found",M="exception",P=Object(T.b)(""),L=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function x(t,e,n){var r=2<arguments.length&&void 0!==n?n:"split name";if(null==t)P.error("".concat(e,": you passed a null or undefined ").concat(r,", ").concat(r," must be a non-empty string."));else if(Object(R.j)(t)){if(L.test(t)&&(P.warn("".concat(e,": ").concat(r,' "').concat(t,'" has extra whitespace, trimming.')),t=t.trim()),0<t.length)return t;P.error("".concat(e,": you passed an empty ").concat(r,", ").concat(r," must be a non-empty string."))}else P.error("".concat(e,": you passed an invalid ").concat(r,", ").concat(r," must be a non-empty string."));return!1}function K(t,e,n,r){return!t.get(t.constants.READY,!0)||n!==D&&null!=n||(P.warn("".concat(r,': you passed "').concat(e,'" that does not exist in this environment, please double check what Splits exist in the web console.')),!1)}var F=Object(T.b)("");function U(t,n,e,r){var i=2<arguments.length&&void 0!==e?e:"split_names",o=3<arguments.length&&void 0!==r?r:"split name";if(Array.isArray(t)&&0<t.length){var a=[];if(t.forEach(function(t){var e=x(t,n,o);e&&a.push(e)}),a.length)return Object(R.s)(a)}return F.error("".concat(n,": ").concat(i," must be a non-empty array.")),!1}var G="localhost",W="standalone",B="producer",H="consumer",Y="MEMORY",z="LOCALSTORAGE",V="control",q={treatment:V,config:null},J="GOOGLE_ANALYTICS_TO_SPLIT",Q="SPLIT_TO_GOOGLE_ANALYTICS",$="IMPRESSION",X="EVENT",Z=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],tt="DEBUG",et="OPTIMIZED",nt=Object(T.b)(""),rt=/[A-Z]/;function it(t,e){if(null==t)nt.error("".concat(e,": you passed a null or undefined traffic_type_name, traffic_type_name must be a non-empty string."));else if(Object(R.j)(t)){if(0!==t.length)return rt.test(t)&&(nt.warn("".concat(e,": traffic_type_name should be all lowercase - converting string to lowercase.")),t=t.toLowerCase()),t;nt.error("".concat(e,": you passed an empty traffic_type_name, traffic_type_name must be a non-empty string."))}else nt.error("".concat(e,": you passed an invalid traffic_type_name, traffic_type_name must be a non-empty string."));return!1}function ot(t,e){nt.warn("".concat(t,": Traffic Type ").concat(e," does not have any corresponding Splits in this environment, make sure you're tracking your events to a valid traffic type defined in the Split console."))}var at=Object(T.b)("",{displayAllErrors:!0});function st(t){return!t.get(t.constants.DESTROYED,!0)||(at.error("Client has already been destroyed - no calls possible."),!1)}function ct(t,e){return!(!t.get(t.constants.READY,!0)&&!t.get(t.constants.READY_FROM_CACHE,!0))||(at.warn("".concat(e,": the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method.")),!1)}function ut(t){var e,n,r;try{e=JSON.parse(t)}catch(t){return null}return null==e?null:{name:e.name,trafficType:e.trafficTypeName||null,killed:e.killed,changeNumber:e.changeNumber||0,treatments:(n=e.conditions,(r=(r=Object(R.b)(n,function(t){return"ROLLOUT"===t.conditionType}))||n[0])?r.partitions.map(function(t){return t.treatment}):[]),configs:e.configurations||{}}}function lt(t){var n=[];return t.forEach(function(t){var e=ut(t);null!=e&&n.push(e)}),n}var ft=function(r,i){var o="split",t=i.get(i.constants.STATUS_MANAGER);return j()(Object.create(t),{split:function(t){var e=x(t,o);if(!st(i)||!ct(i,o)||!e)return null;var n=r.getSplit(e);return S(n)?n.then(function(t){return K(i,e,t,o),ut(t)}):(K(i,e,n,o),ut(n))},splits:function(){if(!st(i)||!ct(i,"splits"))return[];var t=r.getAll();return S(t)?t.then(lt):lt(t)},names:function(){return st(i)&&ct(i,"names")?r.getKeys():[]}})},ht=n(2),pt=n(4);var dt=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)for(var n=t[e].matcherGroup.matchers,r=0;r<n.length;r++)if("IN_SEGMENT"===n[r].matcherType)return!0;return!1};function vt(r,i,o){var a=this,t=this.getSplit(r);return(S(t)?t:Promise.resolve(t)).then(function(t){if(t){var e=JSON.parse(t);if(!e.changeNumber||e.changeNumber<o){e.killed=!0,e.defaultTreatment=i,e.changeNumber=o;var n=JSON.stringify(e);return a.addSplit(r,n)}}return!1})}var gt=function(){function t(){Object(ht.a)(this,t),this.flush()}return Object(pt.a)(t,[{key:"addSplit",value:function(t,e){var n=this.getSplit(t);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}dt(r.conditions)&&this.splitsWithSegmentsCount--}var o=JSON.parse(e);if(o){this.splitCache[t]=e;var a=o.trafficTypeName;return a&&(this.ttCache[a]||(this.ttCache[a]=0),this.ttCache[a]++),dt(o.conditions)&&this.splitsWithSegmentsCount++,!0}return!1}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.addSplit(t[0],t[1]))}),n}},{key:"removeSplit",value:function(t){var e=this.getSplit(t);if(e){delete this.splitCache[t];var n=JSON.parse(e),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),dt(n.conditions)&&this.splitsWithSegmentsCount--,1}return 0}},{key:"removeSplits",value:function(t){var e=this;return t.forEach(function(t){return e.removeSplit(t)}),t.length}},{key:"getSplit",value:function(t){return this.splitCache[t]}},{key:"setChangeNumber",value:function(t){return this.changeNumber=t,!0}},{key:"getChangeNumber",value:function(){return this.changeNumber}},{key:"getAll",value:function(){var e=this;return this.getKeys().map(function(t){return e.splitCache[t]})}},{key:"getKeys",value:function(){return Object.keys(this.splitCache)}},{key:"trafficTypeExists",value:function(t){return Object(R.l)(this.ttCache[t])&&0<this.ttCache[t]}},{key:"usesSegments",value:function(){return-1===this.getChangeNumber()||0<this.splitsWithSegmentsCount}},{key:"flush",value:function(){this.splitCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach(function(t){n[t]=e.splitCache[t]||null}),n}},{key:"checkCache",value:function(){return!1}}]),t}();gt.prototype.killLocally=vt;var mt=gt,yt=Object(T.b)("splitio-storage:localstorage"),bt=function(){function r(t,e,n){Object(ht.a)(this,r),this.keys=t,this.splitFiltersValidation=n,this.__checkExpiration(e),this.__checkFilterQuery()}return Object(pt.a)(r,[{key:"decrementCount",value:function(t){var e=Object(R.p)(localStorage.getItem(t))-1;0<e?localStorage.setItem(t,e):localStorage.removeItem(t)}},{key:"decrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);this.decrementCount(e)}if(dt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();this.decrementCount(n)}}}catch(t){yt.error(t)}}},{key:"incrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);localStorage.setItem(e,Object(R.p)(localStorage.getItem(e))+1)}if(dt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,Object(R.p)(localStorage.getItem(n))+1)}}}catch(t){yt.error(t)}}},{key:"addSplit",value:function(t,e){try{var n=this.keys.buildSplitKey(t),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this.decrementCounts(i),localStorage.setItem(n,e);var o=e?JSON.parse(e):null;return this.incrementCounts(o),!0}catch(t){return yt.error(t),!1}}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.addSplit(t[0],t[1]))}),n}},{key:"removeSplit",value:function(t){try{var e=this.getSplit(t);localStorage.removeItem(this.keys.buildSplitKey(t));var n=JSON.parse(e);return this.decrementCounts(n),1}catch(t){return yt.error(t),0}}},{key:"removeSplits",value:function(t){for(var e=0,n=t.length,r=0;e<n;e++)r+=this.removeSplit(t[e]);return r}},{key:"getSplit",value:function(t){return localStorage.getItem(this.keys.buildSplitKey(t))}},{key:"setChangeNumber",value:function(t){if(this.cacheReadyButNeedsToFlush&&(this.flush(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){yt.info("Split filter query was modified. Updating cache.");var e=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(e,n):localStorage.removeItem(e)}catch(t){yt.error(t)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),t+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0}catch(t){return yt.error(t),!1}}},{key:"getChangeNumber",value:function(){var t=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==t?(t=parseInt(t,10),Object(R.m)(t)?-1:t):-1}},{key:"getAll",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n),i=r&&localStorage.getItem(r);null!=r&&this.keys.isSplitKey(r)&&i&&e.push(i),n++}return e}},{key:"getKeys",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&e.push(this.keys.extractKey(r)),n++}return e}},{key:"trafficTypeExists",value:function(t){var e=Object(R.p)(localStorage.getItem(this.keys.buildTrafficTypeKey(t)));return Object(R.l)(e)&&0<e}},{key:"usesSegments",value:function(){if(!this.hasSync)return!0;var t=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),e=null===t?0:Object(R.p)(t);return!Object(R.l)(e)||0<e}},{key:"flush",value:function(){yt.info("Flushing Splits data from localStorage");for(var t=localStorage.length,e=[],n=0;n<t;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitCacheKey(r)&&e.push(r)}e.forEach(function(t){localStorage.removeItem(t)}),this.hasSync=!1}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach(function(t){n[t]=localStorage.getItem(e.keys.buildSplitKey(t))}),n}},{key:"checkCache",value:function(){return-1<this.getChangeNumber()||this.cacheReadyButNeedsToFlush}},{key:"__checkExpiration",value:function(t){var e=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==e&&(e=parseInt(e,10),!Object(R.m)(e)&&e<t&&this.flush())}},{key:"__checkFilterQuery",value:function(){var t=this,e=this.splitFiltersValidation,n=e.queryString,r=e.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getKeys().forEach(function(e){n&&(-1<r.byName.indexOf(e)||r.byPrefix.some(function(t){return e.startsWith(t+"__")}))?t.cacheReadyButNeedsToFlush=!0:t.removeSplit(e)}))}catch(t){yt.error(t)}}}]),r}();bt.prototype.killLocally=vt;var St=bt,Tt=function(){function e(t){Object(ht.a)(this,e),this.keys=t,this.flush()}return Object(pt.a)(e,[{key:"flush",value:function(){this.segmentCache={}}},{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return this.segmentCache[e]=!0}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return delete this.segmentCache[e],!0}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,this.segmentCache={},t.forEach(function(t){n.addToSegment(t)});else{for(e=0;e<t.length&&this.isInSegment(t[e]);e++);e<t.length&&(r=!0,this.segmentCache={},t.forEach(function(t){n.addToSegment(t)}))}return r}},{key:"isInSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return!0===this.segmentCache[e]}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}}]),e}(),Et=Object(T.b)("splitio-storage:localstorage"),Ot=function(){function e(t){Object(ht.a)(this,e),this.keys=t}return Object(pt.a)(e,[{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.setItem(e,"1"),!0}catch(t){return Et.error(t),!1}}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.removeItem(e),!0}catch(t){return Et.error(t),!1}}},{key:"resetSegments",value:function(t){var e,r=this,n=!1,i=Object.keys(localStorage).reduce(function(t,e){var n=r.keys.extractSegmentName(e);return n&&t.push(n),t},[]);if(0===t.length&&i.length===t.length)return n;if(i.length!==t.length)n=!0,i.forEach(function(t){return r.removeFromSegment(t)}),t.forEach(function(t){return r.addToSegment(t)});else{for(e=0;e<t.length&&-1!==i.indexOf(t[e]);e++);e<t.length&&(n=!0,i.forEach(function(t){return r.removeFromSegment(t)}),t.forEach(function(t){return r.addToSegment(t)}))}return n}},{key:"isInSegment",value:function(t){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(t))}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}},{key:"flush",value:function(){Et.info("Flushing MySegments data from localStorage"),this.resetSegments([])}}]),e}();function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function kt(t){return function(t){if(Array.isArray(t))return _t(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var At=function(){function t(){Object(ht.a)(this,t),this.queue=[]}return Object(pt.a)(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e;return(e=this.queue).push.apply(e,kt(t)),this}},{key:"clear",value:function(){return this.queue.length=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}}]),t}();var wt=function(t,e){for(var n=0,r=t.length-1,i=Math.floor((r+n)/2),o=n,a=r;t[i]!==e&&n<r;)e<t[i]?r=i-1:e>t[i]&&(n=i+1),i=Math.floor((r+n)/2);return i<o?i=o:a<i&&(i=a),e<t[i]&&o<i?i-1:i}.bind(null,[1,1.5,2.25,3.38,5.06,7.59,11.39,17.09,25.63,38.44,57.67,86.5,129.75,194.62,291.93,437.89,656.84,985.26,1477.89,2216.84,3325.26,4987.89,7481.83]),Nt=function(){function t(){Object(ht.a)(this,t),this.clear()}return Object(pt.a)(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t,e){return void 0===this.counters[t]&&(this.counters[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.counters[t][wt(e)]++,this}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),It=function(){function t(){Object(ht.a)(this,t),this.clear()}return Object(pt.a)(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t){return void 0===this.counters[t]?this.counters[t]=1:this.counters[t]++,this.counters[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),jt=function(){function i(t){var e=this;Object(ht.a)(this,i);var n=t.get(t.constants.SETTINGS),r=t.get(t.constants.EVENTS);this.onFullQueue=!1,this.maxQueue=n.scheduler.eventsQueueSize,this.queue=[],this.queueByteSize=0,S(r)?r.then(function(t){e.onFullQueue=t.flushAndResetTimer,e._checkForFlush()}):"function"==typeof r.flushAndResetTimer&&(this.onFullQueue=r.flushAndResetTimer)}return Object(pt.a)(i,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;return this.queueByteSize+=n,this.queue.push(t),this._checkForFlush(),!0}},{key:"clear",value:function(){return this.queue=[],this.queueByteSize=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"_checkForFlush",value:function(){(5242880<this.queueByteSize||0<this.maxQueue&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()}}]),i}(),Rt=/[^.]+$/,Ct=/count\.([^/]+)$/,Dt=/latency\.([^/]+)\.bucket\.([0-9]+)$/,Mt=function(){function e(t){Object(ht.a)(this,e),this.settings=t}return Object(pt.a)(e,[{key:"buildSplitKey",value:function(t){return"".concat(this.settings.storage.prefix,".split.").concat(t)}},{key:"buildTrafficTypeKey",value:function(t){return"".concat(this.settings.storage.prefix,".trafficType.").concat(t)}},{key:"buildSplitsTillKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.till")}},{key:"buildSplitsReady",value:function(){return"".concat(this.settings.storage.prefix,".splits.ready")}},{key:"isSplitKey",value:function(t){return Object(R.o)(t,"".concat(this.settings.storage.prefix,".split."))}},{key:"buildSegmentNameKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"buildSegmentTillKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t,".till")}},{key:"buildRegisteredSegmentsKey",value:function(){return"".concat(this.settings.storage.prefix,".segments.registered")}},{key:"buildSegmentsReady",value:function(){return"".concat(this.settings.storage.prefix,".segments.ready")}},{key:"buildVersionablePrefix",value:function(){return"".concat(this.settings.storage.prefix,"/").concat(this.settings.version,"/").concat(this.settings.runtime.ip)}},{key:"buildImpressionsKey",value:function(){return"".concat(this.settings.storage.prefix,".impressions")}},{key:"buildEventsKey",value:function(){return"".concat(this.settings.storage.prefix,".events")}},{key:"buildLatencyKeyPrefix",value:function(){return"".concat(this.buildVersionablePrefix(),"/latency")}},{key:"buildLatencyKey",value:function(t,e){return"".concat(this.buildLatencyKeyPrefix(),".").concat(t,".bucket.").concat(e)}},{key:"buildCountKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/count.").concat(t)}},{key:"buildGaugeKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/gauge.").concat(t)}},{key:"searchPatternForCountKeys",value:function(){return"".concat(this.buildVersionablePrefix(),"/count.*")}},{key:"searchPatternForSplitKeys",value:function(){return"".concat(this.settings.storage.prefix,".split.*")}},{key:"searchPatternForLatency",value:function(){return"".concat(this.buildLatencyKeyPrefix(),".*")}},{key:"extractKey",value:function(t){var e=t.match(Rt);if(e&&e.length)return e[0];throw new Error("Invalid latency key provided")}},{key:"extractCounterName",value:function(t){var e=t.match(Ct);if(e&&e.length)return e[1];throw new Error("Invalid counter key provided")}},{key:"extractLatencyMetricNameAndBucket",value:function(t){var e=t.match(Dt);if(e&&2<e.length)return{metricName:e[1],bucketNumber:e[2]};throw new Error("Invalid counter key provided")}}]),e}();function Pt(t,e){return(Pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pt(t,e)}var xt=n(17),Kt=n.n(xt);function Ft(t,e){return!e||"object"!==Kt()(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gt(e,t){var n=1<arguments.length&&void 0!==t&&t;return function(t){return Object(R.i)(t)?t[e]:n?void 0:t}}var Wt=Gt("matchingKey"),Bt=Gt("bucketingKey",!0);function Ht(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=Ut(r);if(i){var n=Ut(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ft(this,t)}}var Yt=function(){Lt(r,Mt);var n=Ht(r);function r(t){var e;return Object(ht.a)(this,r),(e=n.call(this,t)).regexSplitCacheKey=new RegExp("^".concat(e.settings.storage.prefix,"\\.(splits?|trafficType)\\.")),e}return Object(pt.a)(r,[{key:"buildSegmentNameKey",value:function(t){return"".concat(Wt(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"extractSegmentName",value:function(t){var e="".concat(Wt(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.");if(Object(R.o)(t,e))return t.substr(e.length)}},{key:"buildSplitsWithSegmentCountKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.usingSegments")}},{key:"buildLastUpdatedKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.lastUpdated")}},{key:"isSplitCacheKey",value:function(t){return this.regexSplitCacheKey.test(t)}},{key:"buildSplitsFilterQueryKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.filterQuery")}}]),r}(),zt=function(t){var e=t.get(t.constants.SETTINGS);switch(e.storage.type){case Y:var n=new Mt(e);return{splits:new mt,segments:new Tt(n),impressions:new At,metrics:new Nt,count:new It,events:new jt(t),shared:function(t){var e=new Mt(t);return{splits:this.splits,segments:new Tt(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new mt,this.segments.flush()}}},destroy:function(){this.splits.flush(),this.segments.flush(),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};case z:var r=new Yt(e),i=Date.now()-864e6;return{splits:new St(r,i,e.sync.__splitFiltersValidation),segments:new Ot(r),impressions:new At,metrics:new Nt,count:new It,events:new jt(t),shared:function(t){var e=new Yt(t);return{splits:this.splits,segments:new Ot(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new mt,this.segments=new Tt(e)}}},destroy:function(){this.splits=new mt,this.segments=new Tt(new Mt(e)),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};default:throw new Error("Unsupported storage type")}},Vt=n(8),qt=n.n(Vt),Jt="init::timeout",Qt="init::ready",$t="init::cache-ready",Xt="state::splits-arrived",Zt="state::segments-arrived",te="state::splits-cache-loaded",ee="state::update",ne="state::check";var re=function(){var u=0,l=new qt.a;l.SDK_SPLITS_CACHE_LOADED=te,l.SDK_SPLITS_ARRIVED=Xt;var f=0;return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=new qt.a;n.SDK_SEGMENTS_ARRIVED=Zt;var r,i,o,a,s,c=(r=l,i=n,o=new qt.a,s=a=0,o.on(ne,function(){14!==s&&u+a===6?(s=14,o.emit(Qt)):14===s&&o.emit(ee)}),r.on(Xt,function(t){t||(u=2),o.emit(ne)}),r.once(te,function(){setTimeout(function(){return o.emit($t)},0)}),i.on(Zt,function(){a=4,o.emit(ne)}),o);return 0<t&&(e=setTimeout(function(){c.emit(Jt,"Split SDK emitted SDK_READY_TIMED_OUT event.")},t),c.once(Qt,function(){return clearTimeout(e)})),c.SDK_READY=Qt,c.SDK_READY_FROM_CACHE=$t,c.SDK_UPDATE=ee,c.SDK_READY_TIMED_OUT=Jt,f++,{splits:l,segments:n,gate:c,destroy:function(){n.removeAllListeners(),c.removeAllListeners(),clearTimeout(e),0<f&&f--,0===f&&l.removeAllListeners()}}}};var ie={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10}},oe=n(9),ae=Object(T.b)("splitio-settings"),se=function(t){var e=t.mode,n=t.storage,r=n.type,i=void 0===r?Y:r,o=n.options,a=void 0===o?{}:o,s=n.prefix;return s?s+=".SPLITIO":s="SPLITIO",e===G?{type:Y,prefix:s}:((i!==Y&&i!==z||i===z&&!Object(oe.a)())&&(i=Y,ae.warn("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:i,options:a,prefix:s})},ce=Object(T.b)("splitio-settings"),ue=function(t,e){var n=1<arguments.length&&void 0!==e?e:[],r=t.integrations;if(!Array.isArray(r)||0===r.length)return[];var i=r.filter(function(t){return t&&Object(R.j)(t.type)&&-1<n.indexOf(t.type)}),o=r.length-i.length;return o&&ce.warn("".concat(o," integration ").concat(1==o?"item":"items"," at settings ").concat(1==o?"is":"are"," invalid: integration items must have a valid 'type' value")),i},le=function(t){return ue(t,[J,Q])};var fe=function(t,e){if("localhost"===t)return G;if(-1===[W,B,H].indexOf(e))throw Error("Invalid mode provided");return e},he=Object(T.b)("splitio-settings");function pe(t,e){var i,o,r={validFilters:[],queryString:null,groupedFilters:{}};return t&&(e!==W?he.warn("split filters have been configured but will have no effect if mode is not '".concat(W,"', since synchronization is being deferred to an external tool.")):Array.isArray(t)&&0!==t.length?(Z.forEach(function(t){r.groupedFilters[t.type]=[]}),r.validFilters=t.filter(function(t,e){return t&&(n=t.type,Z.some(function(t){return t.type===n}))&&Array.isArray(t.values)?(r.groupedFilters[t.type]=r.groupedFilters[t.type].concat(t.values),!0):(he.warn("split filter at position '".concat(e,"' is invalid. It must be an object with a valid filter type ('byName' or 'byPrefix') and a list of 'values'.")),!1);var n}),Z.forEach(function(t){var e=t.type,n=t.maxLength;0<r.groupedFilters[e].length&&(r.groupedFilters[e]=function(t,e,n){var r=U(e,"settings","".concat(t," filter"),"".concat(t," filter value"));if(r){if(r.length>n)throw new Error("".concat(n," unique values can be specified at most for '").concat(t,"' filter. You passed ").concat(r.length,". Please consider reducing the amount or using other filter."));r.sort()}return r||[]}(e,r.groupedFilters[e],n))}),r.queryString=(i=r.groupedFilters,o=[],Z.forEach(function(t){var e=t.type,n=t.queryParam,r=i[e];0<r.length&&o.push(n+r.map(function(t){return encodeURIComponent(t)}).join(","))}),0<o.length?"&"+o.join("&"):null),he.debug("splits filtering criteria is '".concat(r.queryString,"'."))):he.warn("splitFilters configuration must be a non-empty array of filter objects.")),r}var de=Object(T.b)("splitio-settings");var ve=function(t){return t=t.toUpperCase(),-1===[tt,et].indexOf(t)&&(de.error("You passed an invalid impressionsMode, impressionsMode should be one of the following values: '".concat(tt,"' or '").concat(et,"'. Defaulting to '").concat(et,"' mode.")),t=et),t},ge=/^\/(testImpressions|metrics|events)/,me=/^\/auth/,ye=/^\/(sse|event-stream)/,be={mode:W,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,metricsRefreshRate:120,impressionsRefreshRate:60,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io"},storage:{type:Y},debug:void 0,impressionListener:void 0,version:"".concat("javascript","-").concat("10.15.9"),integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:et}};function Se(t){return Math.round(1e3*t)}function Te(t){var e,n=Object(R.k)({},be,ie,t);n.scheduler.featuresRefreshRate=Se(n.scheduler.featuresRefreshRate),n.scheduler.segmentsRefreshRate=Se(n.scheduler.segmentsRefreshRate),n.scheduler.metricsRefreshRate=Se(n.scheduler.metricsRefreshRate),n.scheduler.impressionsRefreshRate=Se(n.scheduler.impressionsRefreshRate),n.scheduler.offlineRefreshRate=Se(n.scheduler.offlineRefreshRate),n.scheduler.eventsPushRate=Se(n.scheduler.eventsPushRate),n.startup.requestTimeoutBeforeReady=Se(n.startup.requestTimeoutBeforeReady),n.startup.readyTimeout=Se(n.startup.readyTimeout),n.startup.eventsFirstPushWindow=Se(n.startup.eventsFirstPushWindow),n.mode=fe(n.core.authorizationKey,n.mode),n.storage=se(n),"boolean"==typeof(e=n.debug)?e?T.a.enable():T.a.disable():"string"==typeof e&&T.a.setLogLevel(e),n.runtime=(n.core.IPAddressesEnabled,n.mode,{ip:!1,hostname:!1}),n.integrations=le(n),!1!==n.streamingEnabled&&(n.streamingEnabled=!0,n.scheduler.pushRetryBackoffBase=Se(n.scheduler.pushRetryBackoffBase));var r=pe(n.sync.splitFilters,n.mode);return n.sync.splitFilters=r.validFilters,n.sync.__splitFiltersValidation=r,n.sync.impressionsMode=ve(n.sync.impressionsMode),n}var Ee={url:function(t){return ge.test(t)?"".concat(this.urls.events).concat(t):me.test(t)?"".concat(this.urls.auth).concat(t):ye.test(t)?"".concat(this.urls.streaming).concat(t):"".concat(this.urls.sdk).concat(t)},overrideKeyAndTT:function(t,e){return j()(Object.create(Ee),this,{core:j()({},this.core,{key:t,trafficType:e})})}},Oe=function(t){return j()(Object.create(Ee),Te(t))},_e={COLLECTORS:"metrics_collectors",DESTROYED:"is_destroyed",EVENTS:"events_publisher",HAS_TIMEDOUT:"has_timedout",INTEGRATIONS_MANAGER:"integrations_manager",MY_SEGMENTS_CHANGE_WORKER:"my_segments_change_worker",PRODUCER:"producer",READINESS:"readiness_gate",READY:"is_ready",READY_FROM_CACHE:"is_ready_from_cache",SETTINGS:"settings",STATUS_MANAGER:"status_manager",STORAGE:"storage",IMPRESSIONS_COUNTER:"impressions_counter"},ke=function(){function t(){Object(ht.a)(this,t),this._map={},this.constants=_e}return Object(pt.a)(t,[{key:"get",value:function(t,e){var n=1<arguments.length&&void 0!==e&&e;if("string"==typeof t&&("string"!=typeof t||t.length)){var r=this._map[t];if(void 0!==r)return r;if(!n){var i,o=new Promise(function(t){return i=t});return o.manualResolve=i,this._map[t]=o}}}},{key:"getAll",value:function(){return j()({},this._map)}},{key:"put",value:function(e,t){var n=this;if("string"!=typeof e||"string"==typeof e&&!e.length||void 0===t)return!1;var r=this._map[e];return(void 0===r||"function"==typeof r.manualResolve)&&(S(r)&&r.manualResolve&&r.manualResolve(t),S(t)&&t.then(function(t){return n._map[e]=t}).catch(function(t){return n._map[e]=void 0,t}),this._map[e]=t,!0)}}]),t}(),Ae=function(t){return Object(R.i)(t)?{matchingKey:t.matchingKey,bucketingKey:t.bucketingKey}:{matchingKey:t,bucketingKey:t}};function we(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ne=n(6),Ie=n(7);var je="object"===("undefined"==typeof performance?"undefined":Object(Ie.a)(performance))&&"function"==typeof performance.now?performance.now.bind(performance):Date.now;function Re(t,e){return"string"==typeof e?t+e:t}function Ce(t,e){var n=Fe[t];return!(!n||!e)&&e[n.collector]}function De(t,e){var n=Fe[t];return!(!n||!e)&&e[n.method]}var Me,Pe=function(){var t=je();return function(){return Math.round(je()-t)}},Le=new Ne.b("[TIME TRACKER]",{showLevel:!1}),xe={},Ke={SDK_READY:"Getting ready - Split SDK",SDK_GET_TREATMENT:"SDK - Get Treatment",SDK_GET_TREATMENTS:"SDK - Get Treatments",SDK_GET_TREATMENT_WITH_CONFIG:"SDK - Get Treatment with config",SDK_GET_TREATMENTS_WITH_CONFIG:"SDK - Get Treatments with config",SPLITS_READY:"Getting ready - Splits",SEGMENTS_READY:"Getting ready - Segments",METRICS_PUSH:"Pushing - Metrics",IMPRESSIONS_PUSH:"Pushing - Impressions",EVENTS_PUSH:"Pushing - Events",MY_SEGMENTS_FETCH:"Fetching - My Segments",SEGMENTS_FETCH:"Fetching - Segments",SPLITS_FETCH:"Fetching - Splits"},Fe=(we(Me={},Ke.SDK_READY,{collector:"client",method:"ready"}),we(Me,Ke.SDK_GET_TREATMENT,{collector:"client",method:"getTreatment"}),we(Me,Ke.SDK_GET_TREATMENTS,{collector:"client",method:"getTreatments"}),we(Me,Ke.SDK_GET_TREATMENT_WITH_CONFIG,{collector:"client",method:"getTreatmentWithConfig"}),we(Me,Ke.SDK_GET_TREATMENTS_WITH_CONFIG,{collector:"client",method:"getTreatmentsWithConfig"}),we(Me,Ke.MY_SEGMENTS_FETCH,{collector:"mySegments",method:"latency"}),we(Me,Ke.SEGMENTS_FETCH,{collector:"segmentChanges",method:"latency"}),we(Me,Ke.SPLITS_FETCH,{collector:"splitChanges",method:"latency"}),Me),Ue={__attachToPromise:function(t,e,n,r){var i=this;return t.then(function(t){return i.stop(e,r),n&&n.count&&n.count(t.status),t}).catch(function(t){throw i.stop(e,r),n&&n.countException&&n.countException(),t})},start:function(t,e,n){var r,i=Object(R.t)(),o=Ce(t,e);S(n)?r=this.__attachToPromise(n,t,o,i):(r=this.stop.bind(this,t,i),Fe[t]&&!o&&(r.setCollectorForTask=this.setCollectorForTask.bind(this,t,i)));var a=Re(t,i),s=De(t,o);return xe[a]={cb:s,timer:Pe()},r},setCollectorForTask:function(t,e,n){var r=Ce(t,n);if(r){var i=Re(t,e);xe[i].cb=De(t,r)}},stop:function(t,e){var n=Re(t,e),r=xe[n];if(r){var i=r.timer();return Le.debug("[".concat(t,"] took ").concat(i,"ms to finish.")),r.cb&&r.cb(i),delete xe[n],i}},TaskNames:Ke},Ge={ALL:1,SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,UNDEFINED:8,EQUAL_TO_SET:9,CONTAINS_ANY_OF_SET:10,CONTAINS_ALL_OF_SET:11,PART_OF_SET:12,ENDS_WITH:13,STARTS_WITH:14,CONTAINS_STRING:15,IN_SPLIT_TREATMENT:16,EQUAL_TO_BOOLEAN:17,MATCHES_STRING:18},We={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};var Be=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).segmentName},He=function(){function n(){var e=this;Object(ht.a)(this,n),this.__setData__=[];var t=arguments[0];Array.isArray(t)&&t.forEach(function(t){e.add(t)})}return Object(pt.a)(n,[{key:"clear",value:function(){this.__setData__.length&&(this.__setData__.length=0)}},{key:"add",value:function(t){return this.has(t)||this.__setData__.push(t),this}},{key:"delete",value:function(t){var e=this.__setData__.indexOf(t);return-1!==e&&(this.__setData__.splice(e,1),!0)}},{key:"has",value:function(t){return-1!==this.__setData__.indexOf(t)}},{key:"forEach",value:function(t,e){var n=e;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(var r=0;r<this.__setData__.length;r++){var i=this.__setData__[r];t.call(n,i,i,this)}}},{key:"size",get:function(){return this.__setData__.length}}]),n}();function Ye(t){return t instanceof He?t.__setData__.slice():Array.from(t)}var ze="function"==typeof Array.from&&"function"==typeof Set&&Set.prototype&&Set.prototype.values?Set:He;var Ve=function(t){return new ze(t.whitelist)};var qe=function(t){return t.whitelist};var Je=function(t){return t.value};function Qe(t){return new Date(t).setUTCHours(0,0,0,0)}function $e(t){return new Date(t).setUTCSeconds(0,0)}var Xe=function(t){var e=t.map(function(t){var e=t.matcherType,n=t.negate,r=t.keySelector,i=t.userDefinedSegmentMatcherData,o=t.whitelistMatcherData,a=t.unaryNumericMatcherData,s=t.betweenMatcherData,c=t.dependencyMatcherData,u=t.booleanMatcherData,l=t.stringMatcherData,f=r&&r.attribute,h=function(t){switch(t){case"ALL_KEYS":return Ge.ALL;case"IN_SEGMENT":return Ge.SEGMENT;case"WHITELIST":return Ge.WHITELIST;case"EQUAL_TO":return Ge.EQUAL_TO;case"GREATER_THAN_OR_EQUAL_TO":return Ge.GREATER_THAN_OR_EQUAL_TO;case"LESS_THAN_OR_EQUAL_TO":return Ge.LESS_THAN_OR_EQUAL_TO;case"BETWEEN":return Ge.BETWEEN;case"EQUAL_TO_SET":return Ge.EQUAL_TO_SET;case"CONTAINS_ANY_OF_SET":return Ge.CONTAINS_ANY_OF_SET;case"CONTAINS_ALL_OF_SET":return Ge.CONTAINS_ALL_OF_SET;case"PART_OF_SET":return Ge.PART_OF_SET;case"ENDS_WITH":return Ge.ENDS_WITH;case"STARTS_WITH":return Ge.STARTS_WITH;case"CONTAINS_STRING":return Ge.CONTAINS_STRING;case"IN_SPLIT_TREATMENT":return Ge.IN_SPLIT_TREATMENT;case"EQUAL_TO_BOOLEAN":return Ge.EQUAL_TO_BOOLEAN;case"MATCHES_STRING":return Ge.MATCHES_STRING;default:return Ge.UNDEFINED}}(e),p=We.STRING,d=void 0;return h===Ge.SEGMENT?d=Be(i):h===Ge.WHITELIST?d=Ve(o):h===Ge.EQUAL_TO?(d=Je(a),p=We.NUMBER,"DATETIME"===a.dataType&&(d=Qe(d),p=We.DATETIME)):h===Ge.GREATER_THAN_OR_EQUAL_TO||h===Ge.LESS_THAN_OR_EQUAL_TO?(d=Je(a),p=We.NUMBER,"DATETIME"===a.dataType&&(d=$e(d),p=We.DATETIME)):h===Ge.BETWEEN?(p=We.NUMBER,"DATETIME"===(d=s).dataType&&(d.start=$e(d.start),d.end=$e(d.end),p=We.DATETIME)):h===Ge.EQUAL_TO_SET||h===Ge.CONTAINS_ANY_OF_SET||h===Ge.CONTAINS_ALL_OF_SET||h===Ge.PART_OF_SET?(d=qe(o),p=We.SET):h===Ge.STARTS_WITH||h===Ge.ENDS_WITH||h===Ge.CONTAINS_STRING?d=qe(o):h===Ge.IN_SPLIT_TREATMENT?(d=c,p=We.NOT_SPECIFIED):h===Ge.EQUAL_TO_BOOLEAN?(p=We.BOOLEAN,d=u):h===Ge.MATCHES_STRING&&(d=l),{attribute:f,negate:n,type:h,value:d,dataType:p}});return-1===Object(R.c)(e,function(t){return t.type===Ge.UNDEFINED})?e:[]};function Ze(t,e){if(!(this instanceof Ze))return new Ze(t,e);if(100!==t[t.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=t,this._treatments=e}Ze.parse=function(t){var e=t.reduce(function(t,e){var n=e.size,r=e.treatment;return t.ranges.push(t.inc+=n),t.treatments.push(r),t},{inc:0,ranges:[],treatments:[]});return new Ze(e.ranges,e.treatments)},Ze.prototype.getTreatmentFor=function(e){if(e<0||100<e)throw new RangeError("Please provide a value between 0 and 100");var t=Object(R.c)(this._ranges,function(t){return e<=t});return this._treatments[t]};var tn=Ze,en=Object(T.b)("splitio-engine:matcher");function nn(t){return en.debug("[allMatcher] is always true"),null!=t}var rn=function(){return nn},on=Object(T.b)("splitio-engine:matcher");var an=function(r,t){return function(e){var n=t.segments.isInSegment(r,e);return S(n)?n.then(function(t){return on.debug("[asyncSegmentMatcher] evaluated ".concat(r," / ").concat(e," => ").concat(n)),t}):on.debug("[segmentMatcher] evaluated ".concat(r," / ").concat(e," => ").concat(n)),n}},sn=Object(T.b)("splitio-engine:matcher");var cn=function(n){return function(t){var e=n.has(t);return sn.debug("[whitelistMatcher] evaluated ".concat(t," in [").concat(Ye(n).join(","),"] => ").concat(e)),e}},un=Object(T.b)("splitio-engine:matcher");var ln=function(n){return function(t){var e=t===n;return un.debug("[equalToMatcher] is ".concat(t," equal to ").concat(n,"? ").concat(e)),e}},fn=Object(T.b)("splitio-engine:matcher");var hn=function(n){return function(t){var e=n<=t;return fn.debug("[greaterThanEqualMatcher] is ".concat(t," greater than ").concat(n,"? ").concat(e)),e}},pn=Object(T.b)("splitio-engine:matcher");var dn=function(n){return function(t){var e=t<=n;return pn.debug("[lessThanEqualMatcher] is ".concat(t," less than ").concat(n,"? ").concat(e)),e}},vn=Object(T.b)("splitio-engine:matcher");var gn=function(n){return function(t){var e=t>=n.start&&t<=n.end;return vn.debug("[betweenMatcher] is ".concat(t," between ").concat(n.start," and ").concat(n.end,"? ").concat(e)),e}},mn=Object(T.b)("splitio-engine:matcher");var yn=function(i){return function(n){for(var t=n.length===i.length,e=function(e){Object(R.c)(i,function(t){return t===n[e]})<0&&(t=!1)},r=0;r<n.length&&t;r++)e(r);return mn.debug("[equalToSetMatcher] is ".concat(n," equal to set ").concat(i,"? ").concat(t)),t}},bn=Object(T.b)("splitio-engine:matcher");var Sn=function(i){return function(t){var n=!0;if(t.length<i.length)n=!1;else for(var e=function(e){Object(R.c)(t,function(t){return t===i[e]})<0&&(n=!1)},r=0;r<i.length&&n;r++)e(r);return bn.debug("[containsAllMatcher] ".concat(t," contains all elements of ").concat(i,"? ").concat(n)),n}},Tn=Object(T.b)("splitio-engine:matcher");var En=function(i){return function(t){for(var n=!1,e=function(e){0<=Object(R.c)(t,function(t){return t===i[e]})&&(n=!0)},r=0;r<i.length&&!n;r++)e(r);return Tn.debug("[containsAnyMatcher] ".concat(t," contains at least an element of ").concat(i,"? ").concat(n)),n}},On=Object(T.b)("splitio-engine:matcher");var _n=function(i){return function(n){for(var t=n.length<=i.length,e=function(e){Object(R.c)(i,function(t){return t===n[e]})<0&&(t=!1)},r=0;r<n.length&&t;r++)e(r);return On.debug("[partOfMatcher] ".concat(n," is part of ").concat(i,"? ").concat(t)),t}},kn=Object(T.b)("splitio-engine:matcher");var An=function(n){return function(e){var t=n.some(function(t){return Object(R.o)(e,t)});return kn.debug("[startsWithMatcher] ".concat(e," starts with ").concat(n,"? ").concat(t)),t}},wn=Object(T.b)("splitio-engine:matcher");var Nn=function(n){return function(e){var t=n.some(function(t){return Object(R.a)(e,t)});return wn.debug("[endsWithMatcher] ".concat(e," ends with ").concat(n,"? ").concat(t)),t}},In=Object(T.b)("splitio-engine:matcher");var jn=function(n){return function(e){var t=n.some(function(t){return Object(R.j)(e)&&-1<e.indexOf(t)});return In.debug("[containsStringMatcher] ".concat(e," contains ").concat(n,"? ").concat(t)),t}},Rn=Object(T.b)("splitio-engine:matcher");function Cn(t,e,n){var r=!1;return Array.isArray(e)&&(r=-1!==e.indexOf(t.treatment)),Rn.debug('[dependencyMatcher] Parent split "'.concat(n,'" evaluated to "').concat(t.treatment,'" with label "').concat(t.label,'". ').concat(n," evaluated treatment is part of [").concat(e,"] ? ").concat(r,".")),r}var Dn=function(t,o){var a=t.split,s=t.treatments;return function(t,e){var n=t.key,r=t.attributes;Rn.debug('[dependencyMatcher] will evaluate parent split: "'.concat(a,'" with key: ').concat(JSON.stringify(n)," ").concat(r?"\n attributes: ".concat(JSON.stringify(r)):""));var i=e(n,a,r,o);return S(i)?i.then(function(t){return Cn(t,s,a)}):Cn(i,s,a)}},Mn=Object(T.b)("splitio-engine:matcher");var Pn=function(n){return function(t){var e=n===t;return Mn.debug("[booleanMatcher] ".concat(n," === ").concat(t)),e}},Ln=Object(T.b)("splitio-engine:matcher");var xn=function(r){return function(t){var e;try{e=new RegExp(r)}catch(t){return Ln.debug("[stringMatcher] ".concat(r," is an invalid regex")),!1}var n=e.test(t);return Ln.debug("[stringMatcher] does ".concat(t," matches with ").concat(r,"? ").concat(n?"yes":"no")),n}};var Kn=function(t,e){var n,r=t.type,i=t.value;return r===Ge.ALL?n=rn(i):r===Ge.SEGMENT?n=an(i,e):r===Ge.WHITELIST?n=cn(i):r===Ge.EQUAL_TO?n=ln(i):r===Ge.GREATER_THAN_OR_EQUAL_TO?n=hn(i):r===Ge.LESS_THAN_OR_EQUAL_TO?n=dn(i):r===Ge.BETWEEN?n=gn(i):r===Ge.EQUAL_TO_SET?n=yn(i):r===Ge.CONTAINS_ANY_OF_SET?n=En(i):r===Ge.CONTAINS_ALL_OF_SET?n=Sn(i):r===Ge.PART_OF_SET?n=_n(i):r===Ge.STARTS_WITH?n=An(i):r===Ge.ENDS_WITH?n=Nn(i):r===Ge.CONTAINS_STRING?n=jn(i):r===Ge.IN_SPLIT_TREATMENT?n=Dn(i,e):r===Ge.EQUAL_TO_BOOLEAN?n=Pn(i):r===Ge.MATCHES_STRING&&(n=xn(i)),n},Fn=Object(T.b)("splitio-engine:sanitize"),Un=Ge,Gn=We;function Wn(t,e){return{key:t,attributes:e}}var Bn=function(t,e,n,r){var i,o,a,s,c,u=function(t,e){switch(t){case Un.EQUAL_TO:return"DATETIME"===e?Qe:void 0;case Un.GREATER_THAN_OR_EQUAL_TO:case Un.LESS_THAN_OR_EQUAL_TO:case Un.BETWEEN:return"DATETIME"===e?$e:void 0;case Un.IN_SPLIT_TREATMENT:return Wn;default:return}}(t,n);switch(n){case Gn.NUMBER:case Gn.DATETIME:s=e,c=Object(R.p)(s),i=isNaN(c)?void 0:c;break;case Gn.STRING:i=function(t){var e=t;Object(R.i)(t)&&(e=t.matchingKey?t.matchingKey:void 0);var n=Object(R.q)(e);return n||void 0}(e);break;case Gn.SET:o=e,i=(a=Array.isArray(o)?Object(R.s)(o.map(function(t){return t+""})):[]).length?a:void 0;break;case Gn.BOOLEAN:i=function(t){if(!0===t||!1===t)return t;if("string"==typeof t){var e=t.toLocaleLowerCase();if("true"===e)return!0;if("false"===e)return!1}}(e);break;case Gn.NOT_SPECIFIED:i=e;break;default:i=void 0}return u&&(i=u(i,r)),Fn.debug("Attempted to sanitize [".concat(e,"] which should be of type [").concat(n,"]. \n Sanitized and processed value => [").concat(i instanceof Object?JSON.stringify(i):i,"]")),i},Hn=Object(T.b)("splitio-engine:value");var Yn=function(t,e,n){var r,i,o,a,s=e.attribute,c=(r=t,o=n,a=void 0,(i=s)?o?(a=o[i],Hn.debug("Extracted attribute [".concat(i,"], [").concat(a,"] will be used for matching."))):Hn.warn("Defined attribute [".concat(i,"], no attributes received.")):a=r,a),u=Bn(e.type,c,e.dataType,n);return void 0!==u?u:void Hn.warn("Value ".concat(c," ").concat(s?"for attribute ".concat(s," "):0,"doesn't match with expected type."))};function zn(t){return r=t,e=(r=Number(r))<0?Math.ceil(r):Math.floor(r),n=Math.pow(2,32),e-Math.floor(e/n)*n;var e,n,r}function Vn(t){var e=zn(t);return e>=Math.pow(2,31)?e-Math.pow(2,32):e}function qn(t,e){for(var n=0,r=0;r<t.length;r++)n=Vn(Vn(31*n)+t.charCodeAt(r));return Vn(n^e)}var Jn,Qn,$n=function(t,e){return Math.abs(qn(t,e)%100)+1},Xn=(Jn={encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):(n<2048?e(n>>6&31|192):(n<65536?e(n>>12&15|224):(e(n>>18&7|240),e(n>>12&63|128)),e(n>>6&63|128)),e(63&n|128)),n=null},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)55296<=n&&n<=57343&&null!==(r=t())&&56320<=r&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},encodeUTF16toUTF8:function(t,e){Jn.UTF16toUTF8(t,function(t){Jn.encodeUTF8(t,e)})}},Qn=String.fromCharCode,Jn.stringSource=function(t){if("string"!=typeof t)throw TypeError("Illegal argument: "+Object(Ie.a)(t));var e=0;return function(){return e>=t.length?null:t.charCodeAt(e++)}},Jn.stringDestination=function(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+Qn.apply(String,t);1024<t.length+arguments.length&&(e.push(Qn.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}},Jn),Zn=Xn.stringSource,tr=Xn.stringDestination,er=Xn.encodeUTF16toUTF8;
/*!
 * +----------------------------------------------------------------------------------+
 * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
 * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
 * |----------------------------------------------------------------------------------|
 * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
 * +----------------------------------------------------------------------------------+
 */
function nr(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function rr(t,e){return t<<e|t>>>32-e}
/*!
 * +----------------------------------------------------------------------------------+
 * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
 * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
 * |----------------------------------------------------------------------------------|
 * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
 * +----------------------------------------------------------------------------------+
 */
function ir(t,e){e=e||0;for(var n,r=(t=t||"").length%4,i=t.length-r,o=e,a=0,s=3432918353,c=461845907,u=0;u<i;u+=4)a=nr(a=255&t.charCodeAt(u)|(255&t.charCodeAt(u+1))<<8|(255&t.charCodeAt(u+2))<<16|(255&t.charCodeAt(u+3))<<24,s),a=nr(a=rr(a,15),c),o=nr(o=rr(o^=a,13),5)+3864292196;switch(a=0,r){case 3:a^=(255&t.charCodeAt(u+2))<<16;case 2:a^=(255&t.charCodeAt(u+1))<<8;case 1:a=nr(a^=255&t.charCodeAt(u),s),o^=a=nr(a=rr(a,15),c)}return o^=t.length,n=o,n=nr(n^=n>>>16,2246822507),n=nr(n^=n>>>13,3266489909),(o=n^=n>>>16)>>>0}function or(t,e){return ir((er(Zn(t),n=tr()),n()),e>>>0);var n}var ar={hash:or,bucket:function(t,e){return Math.abs(or(t,e)%100)+1}},sr=Object(T.b)("splitio-engine");function cr(t){return 2===t?ar.bucket:$n}var ur={getTreatment:function(t,e,n,r){var i=cr(r)(t,e),o=n.getTreatmentFor(i);return sr.debug("[engine] using algo ".concat(2!==r?"legacy":"murmur"," bucket ").concat(i," for key ").concat(t," using seed ").concat(e," - treatment ").concat(o)),o},shouldApplyRollout:function(t,e,n,r){if(t<100&&t<cr(r)(e,n))return!1;return!0}};function lr(t,e,n,r,i,o){if(t)return{treatment:ur.getTreatment(e,n,r,o),label:i}}var fr=function(c,u,l,f){return function(e,n,t,r,i,o,a){if("ROLLOUT"===f&&!ur.shouldApplyRollout(t,e.bucketingKey,r,a))return{treatment:void 0,label:"not in split"};var s=c(e,o,i);return S(s)?s.then(function(t){return lr(t,e.bucketingKey,n,u,l,a)}):lr(s,e.bucketingKey,n,u,l,a)}},hr=Object(T.b)("splitio-engine:combiner");function pr(){return hr.error("Invalid Split provided, no valid conditions found"),{treatment:V,label:M}}function dr(t){for(var e=t.length,n=0;n<e;n++){var r=t[n];if(void 0!==r)return hr.debug("Treatment found: ".concat(r.treatment)),r}hr.debug("All predicates evaluated, no treatment found.")}var vr=function(c){return!Array.isArray(c)||Array.isArray(c)&&0===c.length?pr:function(e,n,r,i,o,a,s){var t=c.map(function(t){return t(e,n,r,i,s,o,a)});return-1!==Object(R.c)(t,S)?Promise.all(t).then(function(t){return dr(t)}):dr(t)}},gr=Object(T.b)("splitio-engine:combiner");function mr(t){for(var e,n=0,r=t.length;n<r&&t[n];n++);return e=n===r,gr.debug("[andCombiner] evaluates to ".concat(e)),e}var yr=function(i){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=i.map(function(t){return t.apply(void 0,e)});return-1!==Object(R.c)(r,S)?Promise.all(r).then(mr):mr(r)}};var br=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=i.matcherGroup.matchers,a=i.partitions,s=i.label,c=i.conditionType,u=(o=Xe(o)).map(function(o){var a=Kn(o,e);return function(t,e,n){var r=Yn(t,o,e),i=void 0!==r&&a(r,n);return S(i)?i.then(function(t){return Boolean(t^o.negate)}):Boolean(i^o.negate)}});if(0===u.length){n=[];break}n.push(fr(yr(u),tn.parse(a),s,c))}return vr(n)};function Sr(t,e){return{treatment:Object(R.e)(t,"treatment",e),label:Object(R.e)(t,"label","default rule")}}function Tr(t,e){if(!(this instanceof Tr))return new Tr(t,e);var n;this.baseInfo=t,this.evaluator=e,"string"!=typeof(n=this).baseInfo.defaultTreatment&&(n.baseInfo.defaultTreatment=V)}Tr.parse=function(t,e){var n=t.conditions,r=br(n,e);return new Tr(j()({},t),r)},Tr.prototype.getKey=function(){return this.baseInfo.name},Tr.prototype.getTreatment=function(t,e,n){var r,i,o,a=this.baseInfo,s=a.killed,c=a.seed,u=a.defaultTreatment,l=a.trafficAllocation,f=a.trafficAllocationSeed,h=a.algo;try{r=Ae(t)}catch(t){return{treatment:V,label:M}}if(this.isGarbage())i=V,o="archived";else{if(!s){var p=this.evaluator(r,c,l,f,e,h,n);return S(p)?p.then(function(t){return Sr(t,u)}):Sr(p,u)}i=u,o="killed"}return{treatment:i,label:o}},Tr.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},Tr.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber};var Er=Tr,Or={treatment:V,label:M,config:null};function _r(e,t,n,r){var i;try{i=r.splits.getSplit(t)}catch(t){return Promise.resolve(Or)}return S(i)?i.then(function(t){return kr(t,e,n,r)}):kr(i,e,n,r)}function kr(t,e,n,r){var i={treatment:V,label:D,config:null};if(t){var o=JSON.parse(t),a=Er.parse(o,r);if(i=a.getTreatment(e,n,_r),S(i))return i.then(function(t){return t.changeNumber=a.getChangeNumber(),t.config=Object(R.e)(o,"configurations.".concat(t.treatment),null),t});i.changeNumber=a.getChangeNumber(),i.config=Object(R.e)(o,"configurations.".concat(i.treatment),null)}return i}function Ar(t,n,r,i,o){var a={},s=[];return t.forEach(function(e){var t=kr(n[e],r,i,o);S(t)?s.push(t.then(function(t){a[e]=t})):a[e]=t}),0<s.length?Promise.all(s).then(function(){return a}):a}function wr(t,e,n,r){Object(ht.a)(this,wr),this.list=r,this.value=t,e?(e.next=this).prev=e:this.prev=null,n?(n.prev=this).next=n:this.next=null}var Nr=function(){function t(){Object(ht.a)(this,t),this.tail=null,this.head=null,this.length=0}return Object(pt.a)(t,[{key:"removeNode",value:function(t){if(t&&t instanceof wr){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e}}},{key:"unshiftNode",value:function(t){if(t&&t instanceof wr&&t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,(t.next=e)&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}}},{key:"unshift",value:function(){for(var t=0,e=arguments.length;t<e;t++)this.head=new wr(arguments[t],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length}}]),t}(),Ir="undefined"!=typeof Map?Map:function(){function t(){Object(ht.a)(this,t)}return Object(pt.a)(t,[{key:"set",value:function(t,e){this[t]=e}},{key:"get",value:function(t){return this[t]}},{key:"delete",value:function(t){delete this[t]}},{key:"size",get:function(){return Object.keys(this).length}}]),t}(),jr=function(){function e(t){Object(ht.a)(this,e),this.maxLen=t||1,this.items=new Ir,this.lru=new Nr}return Object(pt.a)(e,[{key:"get",value:function(t){var e=this.items.get(t);if(e&&e instanceof wr)return this.lru.unshiftNode(e),e.value.value}},{key:"set",value:function(t,e){var n=this.items.get(t);if(n){if(!(n instanceof wr))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=e}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:t,value:e}),this.items.set(t,this.lru.head)}return!0}}]),e}(),Rr=function(){function n(t,e){Object(ht.a)(this,n),this.cache=new jr(t),this.hasher=e}return Object(pt.a)(n,[{key:"testAndSet",value:function(t){if(!t)return null;var e=this.hasher(t),n=this.cache.get(e);return this.cache.set(e,t.time),n}}]),n}(),Cr="UNKNOWN";function Dr(t){return t||Cr}function Mr(t){return t?ar.hash("".concat(Dr((e=t).keyName),"\n    :").concat(Dr(e.feature),"\n    :").concat(Dr(e.treatment),"\n    :").concat(Dr(e.label),"\n    :").concat(e.changeNumber||0)).toString():null;var e}var Pr=function(){return new Rr(500,Mr)},Lr=36e5;function xr(t){return t-t%Lr}var Kr=Object(T.b)("splitio-client:impressions-tracker");function Fr(t){return-1<[B,W].indexOf(t.mode)}var Ur=function(t){var e,a=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),s=n.impressionListener,c=t.get(t.constants.INTEGRATIONS_MANAGER,!0),r=n.runtime,u=r.ip,l=r.hostname,f=n.version,h=[],p=Fr(n),d=!!Fr(e=n)&&e.sync.impressionsMode===et,v=Pr(),g=t.get(t.constants.IMPRESSIONS_COUNTER);return{queue:function(t,e){h.push({impression:t,attributes:e})},track:function(){var e=h.length,n=h.splice(0,e),r=[];n.forEach(function(t){var e=t.impression;p&&(e.pt=v.testAndSet(e));var n=Date.now();d&&g&&g.inc(e.feature,n,1),d&&e.pt&&!(e.pt<xr(n))||r.push(e)});var t=a.track(r);if(S(t)&&t.then(function(){Kr.debug("Successfully stored ".concat(e," impression").concat(1===e?"":"s","."))}).catch(function(t){Kr.error("Could not store impressions bulk with ".concat(e," impression").concat(1===e?"":"s",". Error: ").concat(t))}),s||c)for(var i=function(t){var e={impression:j()({},n[t].impression),attributes:n[t].attributes,ip:u,hostname:l,sdkLanguageVersion:f};setTimeout(function(){c&&c.handleImpression(e);try{s&&s.logImpression(e)}catch(t){Kr.error("Impression listener logImpression method threw: ".concat(t,"."))}},0)},o=0;o<e;o++)i(o)}}},Gr=Object(T.b)("splitio-client:event-tracker");var Wr=function(t){var r=t.get(t.constants.STORAGE).events,u=t.get(t.constants.INTEGRATIONS_MANAGER,!0);function i(e,t){var n=e.eventTypeId,r=e.trafficTypeName,i=e.key,o=e.value,a=e.timestamp,s=e.properties,c='event of type "'.concat(n,'" for traffic type "').concat(r,'". Key: ').concat(i,". Value: ").concat(o,". Timestamp: ").concat(a,". ").concat(s?"With properties.":"With no properties.");return t?(Gr.info("Successfully queued ".concat(c)),u&&setTimeout(function(){var t=j()({},e);e.properties&&(t.properties=j()({},e.properties)),u.handleEvent(t)},0)):Gr.warn("Failed to queue ".concat(c)),t}return{track:function(t,e){var n=r.track(t,e);return S(n)?n.then(i.bind(null,t)):i(t,n)}}},Br=Object(T.b)("splitio-client");var Hr=function(d){var c=d.get(d.constants.STORAGE),u=d.get(d.constants.COLLECTORS),v=Ur(d),l=Wr(d);function r(n,r,i){function e(t){var e=f(t,r,n,i,o,"getTreatment".concat(o?"withConfig":""));return v.track(),a(),e}var o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],t=Ue.TaskNames[o?"SDK_GET_TREATMENT_WITH_CONFIG":"SDK_GET_TREATMENT"],a=Ue.start(t,u),s=_r(n,r,i,c);return S(s)?s.then(function(t){return e(t)}):e(s)}function i(r,t,i){function e(e){var n={};return Object.keys(e).forEach(function(t){n[t]=f(e[t],t,r,i,o,"getTreatments".concat(o?"withConfig":""))}),v.track(),a(),n}var o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=Ue.TaskNames[o?"SDK_GET_TREATMENTS_WITH_CONFIG":"SDK_GET_TREATMENTS"],a=Ue.start(n,u),s=function(e,n,r,i){var t,o={};try{t=i.splits.fetchMany(n)}catch(t){return n.forEach(function(t){o[t]=Or}),Promise.resolve(o)}return S(t)?t.then(function(t){return Ar(n,t,e,r,i)}):Ar(n,t,e,r,i)}(r,t,i,c);return S(s)?s.then(function(t){return e(t)}):e(s)}function f(t,e,n,r,i,o){var a=d.get(d.constants.READY,!0)||d.get(d.constants.READY_FROM_CACHE,!0),s=Wt(n),c=Bt(n);a||(t={treatment:V,label:"not ready"});var u=t.treatment,l=t.label,f=t.changeNumber,h=t.config,p=void 0===h?null:h;return Br.info("Split: ".concat(e,". Key: ").concat(s,". Evaluation: ").concat(u,". Label: ").concat(l)),K(d,e,l,o)&&(Br.info("Queueing corresponding impression."),v.queue({feature:e,keyName:s,treatment:u,time:Date.now(),bucketingKey:c,label:l,changeNumber:f},r)),i?{treatment:u,config:p}:u}return{getTreatment:r,getTreatmentWithConfig:function(t,e,n){return r(t,e,n,!0)},getTreatments:i,getTreatmentsWithConfig:function(t,e,n){return i(t,e,n,!0)},track:function(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1024,a=Wt(t),s={eventTypeId:n,trafficTypeName:e,value:r,timestamp:Date.now(),key:a,properties:i};return function(e,t,n){var r=t.get(t.constants.READY,!0),i=t.get(t.constants.SETTINGS),o=t.get(t.constants.STORAGE).splits;if(!r||i.mode===G)return;var a=o.trafficTypeExists(e);S(a)?a.then(function(t){return t||ot(n,e),t}):a||ot(n,e)}(e,d,"track"),l.track(s,o)}}};var Yr=function(h,p,d){var v="REDIS"!==h.get(h.constants.SETTINGS).storage.type,t=Hr(h),i=t.getTreatment,o=t.getTreatmentWithConfig,a=t.getTreatments,s=t.getTreatmentsWithConfig,g=t.track;function c(t,e,n,r){var i,o,a=Object(R.o)(r,"getTreatments"),s=p?t:I(t,r),c=a?U(e,r):x(e,r),u=(i=n,o=r,Object(R.i)(i)||null==i?i:(f.error("".concat(o,": attributes must be a plain object.")),!1)),l=st(h);return ct(h,r),{valid:l&&s&&c&&!1!==u,key:s,splitOrSplits:c,attributes:u}}return t.getTreatment=function(t,e,n){var r=c(t,e,n,"getTreatment");return r.valid?i(r.key,r.splitOrSplits,r.attributes):v?V:Promise.resolve(V)},t.getTreatmentWithConfig=function(t,e,n){var r=c(t,e,n,"getTreatmentWithConfig");return r.valid?o(r.key,r.splitOrSplits,r.attributes):v?j()({},q):Promise.resolve(j()({},q))},t.getTreatments=function(t,e,n){var r=c(t,e,n,"getTreatments");if(r.valid)return a(r.key,r.splitOrSplits,r.attributes);var i={};return r.splitOrSplits&&r.splitOrSplits.forEach(function(t){return i[t]=V}),v?i:Promise.resolve(i)},t.getTreatmentsWithConfig=function(t,e,n){var r=c(t,e,n,"getTreatmentsWithConfig");if(r.valid)return s(r.key,r.splitOrSplits,r.attributes);var i={};return r.splitOrSplits&&r.splitOrSplits.forEach(function(t){return i[t]=j()({},q)}),v?i:Promise.resolve(i)},t.track=function(t,e,n,r,i){var o=p?t:I(t,"track"),a=d?e:it(e,"track"),s=_(n,"track"),c=k(r,"track"),u=w(i,"track"),l=u.properties,f=u.size;return st(h)&&o&&a&&s&&!1!==c&&!1!==l?g(o,a,s,c,l,f):!v&&Promise.resolve(!1)},t};var zr=function(t){var e,n=t.get(t.constants.SETTINGS),r=Object(R.e)(n,"core.key",void 0),i=Object(R.e)(n,"core.trafficType",void 0);n.mode===G&&void 0===r?n.core.key="localhost_key":n.core.key=I(r,"Client instantiation");var o=[n.core.key];if(void 0!==i){var a=it(i,"Client instantiation");n.core.trafficType=a,o.push(a)}var s=Yr(t,!0,1<o.length);return s.isBrowserClient=!0,s.getTreatment=s.getTreatment.bind(s,n.core.key),s.getTreatmentWithConfig=s.getTreatmentWithConfig.bind(s,n.core.key),s.getTreatments=s.getTreatments.bind(s,n.core.key),s.getTreatmentsWithConfig=s.getTreatmentsWithConfig.bind(s,n.core.key),s.track=(e=s.track).bind.apply(e,[s].concat(o)),s};var Vr=function(i,o){for(var t=arguments.length,e=new Array(2<t?t-2:0),n=2;n<t;n++)e[n-2]=arguments[n];var a,s=!1;function c(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o,e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];s||(a=setTimeout(function(){i.apply(void 0,n.concat([c]))},t))}function r(){clearTimeout(a),s=!(a=void 0)}return r.reset=function(){clearTimeout(a),c.apply(a=void 0,[o].concat(e))},i.apply(void 0,e.concat([c])),r},qr=function(c,u){return u=u||{},new Promise(function(t,e){var n=new XMLHttpRequest,r=[],i=[],o={},a=function(){return{ok:2==(n.status/100|0),statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:a,headers:{keys:function(){return r},entries:function(){return i},get:function(t){return o[t.toLowerCase()]},has:function(t){return t.toLowerCase()in o}}}};for(var s in n.open(u.method||"get",c,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(t,e,n){r.push(e=e.toLowerCase()),i.push([e,n]),o[e]=o[e]?o[e]+","+n:n}),t(a())},n.onerror=e,n.withCredentials="include"==u.credentials,u.headers)n.setRequestHeader(s,u.headers[s]);n.send(u.body||null)})};function Jr(t,e,n){return(Jr=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Pt(i,n.prototype),i}).apply(null,arguments)}function Qr(t){var r="function"==typeof Map?new Map:void 0;return(Qr=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return Jr(t,arguments,Ut(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Pt(n,t)})(t)}function $r(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=Ut(r);if(i){var n=Ut(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ft(this,t)}}var Xr=function(){Lt(r,Qr(Error));var n=$r(r);function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Split Error";return Object(ht.a)(this,r),(t=n.call(this,e)).message=e,t}return r}(),Zr=function(){Lt(n,Xr);var e=$r(n);function n(t){return Object(ht.a)(this,n),e.call(this,t||"Split Timeout Error")}return n}(),ti=function(){Lt(i,Xr);var r=$r(i);function i(t,e){var n;return Object(ht.a)(this,i),(n=r.call(this,t||"Split Network Error")).statusCode=e,n}return i}(),ei=Object(T.b)("splitio-services:service");function ni(r){var i=r.url,t="function"==typeof fetch?fetch:qr;return t?t(i,r).then(function(e){return e.ok?e:e.text().then(function(t){return Promise.reject({response:e,message:t})})}).catch(function(t){var e=t.response,n="";if(e)switch(e.status){case 404:n="Invalid API key or resource not found.";break;default:n=t.message}else n=t.message;throw e&&403===e.status||ei[r.logErrorsAsInfo?"info":"error"]("Response status is not OK. Status: ".concat(e?e.status:"NO_STATUS",". URL: ").concat(i,". Message: ").concat(n)),new ti(n,e&&e.status)}):Promise.reject(new ti("Global fetch API is not available."))}var ri=ni;var ii=function(t,e,n,r){var i=t.core.authorizationKey,o=t.version,a=t.runtime,s=a.ip,c=a.hostname,u={},l={};return u.Accept="application/json",u["Content-Type"]="application/json",u.Authorization="Bearer ".concat(i),u.SplitSDKVersion=o,s&&(u.SplitSDKMachineIP=s),c&&(u.SplitSDKMachineName=c),r&&j()(u,r),j()({headers:u,url:t.url(e)},l,n)},oi={"Cache-Control":"no-cache"};var ai=ni;function si(t,e){return ii(t,"/testImpressions/bulk",j()({method:"POST"},e),{SplitSDKImpressionsMode:t.sync.impressionsMode===et?et:tt})}function ci(t,e){return ii(t,"/testImpressions/count",j()({method:"POST"},e))}function ui(t,e){var n=e.core.labelsEnabled,r=Object(R.g)(t.state(),"feature"),i=[];return Object(R.d)(r,function(t,e){i.push({f:e,i:t.map(function(t){var e={k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber};return n&&(e.r=t.label),t.bucketingKey&&(e.b=t.bucketingKey),t.pt&&(e.pt=t.pt),e})})}),i}function li(t){var e=[];if(0===(t?t.size():0))return e;for(var n=t.popAll(),r=Object.keys(n),i=0;i<r.length;i++){var o=r[i].split("::");if(2===o.length){var a=o[0],s=o[1],c={f:a,m:Number(s),rc:n[r[i]]};e.push(c)}}return e}function fi(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=Ut(r);if(i){var n=Ut(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Ft(this,t)}}var hi=function(){function e(t){Object(ht.a)(this,e),this.storage=t,this.latency=this.latency.bind(this),this.count=this.count.bind(this),this.countException=this.countException.bind(this)}return Object(pt.a)(e,[{key:"latency",value:function(t){this.storage.metrics.track("".concat(this.metricType,".time"),t)}},{key:"count",value:function(t){this.storage.count.track("".concat(this.metricType,".status.").concat(t))}},{key:"countException",value:function(){this.storage.count.track("".concat(this.metricType,".exception"))}}]),e}(),pi=function(){Lt(r,hi);var n=fi(r);function r(t){var e;return Object(ht.a)(this,r),(e=n.call(this,t)).metricType="segmentChangeFetcher",e}return r}(),di=function(){Lt(r,hi);var n=fi(r);function r(t){var e;return Object(ht.a)(this,r),(e=n.call(this,t)).metricType="splitChangeFetcher",e}return r}(),vi=function(){Lt(r,hi);var n=fi(r);function r(t){var e;return Object(ht.a)(this,r),(e=n.call(this,t)).metricType="mySegmentsFetcher",e}return r}(),gi=function(){function e(t){Object(ht.a)(this,e),this.storage=t,this.ready=this.ready.bind(this),this.getTreatment=this.getTreatment.bind(this),this.getTreatments=this.getTreatments.bind(this),this.getTreatmentWithConfig=this.getTreatmentWithConfig.bind(this),this.getTreatmentsWithConfig=this.getTreatmentsWithConfig.bind(this)}return Object(pt.a)(e,[{key:"ready",value:function(t){this.storage.metrics.track("sdk.ready",t)}},{key:"getTreatment",value:function(t){this.storage.metrics.track("sdk.getTreatment",t)}},{key:"getTreatments",value:function(t){this.storage.metrics.track("sdk.getTreatments",t)}},{key:"getTreatmentWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentWithConfig",t)}},{key:"getTreatmentsWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentsWithConfig",t)}}]),e}(),mi=Object(T.b)("splitio-metrics"),yi=function(t){function e(){if(d.metrics.isEmpty()&&d.count.isEmpty())return Promise.resolve();mi.info("Pushing metrics");var t,e,n,r,i,o,a,s,c,u,l=Ue.start(Ue.TaskNames.METRICS_PUSH),f=d.metrics.isEmpty()?null:ri((t=p,e={body:JSON.stringify((n=d.metrics,r=[],i=n.toJSON(),Object(R.d)(i,function(t,e){r.push({name:e,latencies:t})}),r))},ii(t,"/metrics/times",j()({method:"POST"},e,{logErrorsAsInfo:!0})))).then(function(){return d.metrics.clear()}).catch(function(){return d.metrics.clear()}),h=d.count.isEmpty()?null:ri((o=p,a={body:JSON.stringify((s=d.count,c=[],u=s.toJSON(),Object(R.d)(u,function(t,e){c.push({name:e,delta:t})}),c))},ii(o,"/metrics/counters",j()({method:"POST"},a,{logErrorsAsInfo:!0})))).then(function(){return d.count.clear()}).catch(function(){return d.count.clear()});return Promise.all([f,h]).then(function(t){return l(),t})}function n(){if(d.impressions.isEmpty())return Promise.resolve();var e=d.impressions.queue.length;mi.info("Pushing ".concat(e," impressions"));var t=Ue.start(Ue.TaskNames.IMPRESSIONS_PUSH);return ai(si(p,{body:JSON.stringify(ui(d.impressions,p))})).then(function(){i=0,d.impressions.clear()}).catch(function(t){i?(mi.warn("Droping ".concat(e," impressions after retry. Reason ").concat(t,".")),i=0,d.impressions.clear()):(i++,mi.warn("Failed to push ".concat(e," impressions, keeping data to retry on next iteration. Reason ").concat(t,".")))}).then(function(){return t()})}function r(){var t=li(o),e=t.length;return 0===e?Promise.resolve():(mi.info("Pushing count of impressions for ".concat(e," features")),ai(ci(p,{body:JSON.stringify({pf:t})})).then(function(){i=0}).catch(function(t){i?(mi.warn("Droping count of impressions for ".concat(e," features after retry. Reason ").concat(t,".")),i=0):(i++,mi.warn("Failed to push impressions count for ".concat(e," features, keeping data to retry on next iteration. Reason ").concat(t,".")))}))}var i=0,p=t.get(t.constants.SETTINGS),d=t.get(t.constants.STORAGE),o=t.get(t.constants.IMPRESSIONS_COUNTER),a=p.sync.impressionsMode===et,s=!1,c=!1,u=!1;return{start:function(){s=Vr(function(t){return n().then(function(){return t()})},p.scheduler.impressionsRefreshRate),c=Vr(function(t){return e().then(function(){return t()})},p.scheduler.metricsRefreshRate),a&&(u=Vr(function(t){return r().then(function(){return t()})},18e5))},flush:function(){return a&&r(),n()},stop:function(){s&&s(),c&&c(),u&&u()},collectors:{segmentChanges:new pi(d),splitChanges:new di(d),mySegments:new vi(d),client:new gi(d)}}},bi=ni;function Si(t,e){return ii(t,"/events/bulk",j()({method:"POST"},e))}var Ti=Object(T.b)("splitio-events"),Ei=function(t){function e(){if(i.events.isEmpty())return Promise.resolve();function t(){return e()}Ti.info("Pushing ".concat(i.events.state().length," queued events."));var e=Ue.start(Ue.TaskNames.EVENTS_PUSH),n=JSON.stringify(i.events.toJSON());return i.events.clear(),bi(Si(r,{body:n})).then(t).catch(t)}function n(){return a=Vr(function(t){return e().then(function(){return t()})},r.scheduler.eventsPushRate)}var r=t.get(t.constants.SETTINGS),i=t.get(t.constants.STORAGE),o=!1,a=!1;return{start:function(){0<r.startup.eventsFirstPushWindow?o=setTimeout(n,r.startup.eventsFirstPushWindow):n()},flush:function(){return e()},stop:function(){o&&clearTimeout(o),a&&a()},flushAndResetTimer:function(){return Ti.info("Flushing events and reseting timer."),a&&a.reset(),e()}}},Oi=ni;function _i(t){return"users="+encodeURIComponent(t)}function ki(t){var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}function Ai(t,e){return Oi(function(t,e){var n="/auth";if(e){var r=e.map(_i).join("&");r&&(n+="?"+r)}return ii(t,n)}(t,e)).then(function(t){return t.json()}).then(function(t){if(t.token){var e=ki(t.token);if("number"!=typeof e.iat||"number"!=typeof e.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(e["x-ably-capability"]);return j()({decodedToken:e,channels:n},t)}return t})}function wi(){return"function"==typeof EventSource?EventSource:void 0}var Ni=function(){function r(t,e,n){Object(ht.a)(this,r),this.baseMillis=e||r.DEFAULT_BASE_MILLIS,this.maxMillis=n||r.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=t}return Object(pt.a)(r,[{key:"scheduleCall",value:function(){var t=this,e=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout(function(){t.cb()},e),this.attempts++,e}},{key:"reset",value:function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=0)}}]),r}();Ni.DEFAULT_BASE_MILLIS=1e3,Ni.DEFAULT_MAX_MILLIS=18e5;var Ii=Ni,ji=function(){function n(t,e){Object(ht.a)(this,n),this.mySegmentsStorage=t,this.mySegmentsProducer=e,this.maxChangeNumber=0,this.segmentList=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentUpdateCall=this.__handleMySegmentUpdateCall.bind(this),this.backoff=new Ii(this.__handleMySegmentUpdateCall)}return Object(pt.a)(n,[{key:"__handleMySegmentUpdateCall",value:function(){var e=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var n=this.maxChangeNumber;this.mySegmentsProducer.synchronizeMySegments(this.segmentList,!0).then(function(t){!1!==t&&(e.currentChangeNumber=Math.max(e.currentChangeNumber,n)),e.handleNewEvent?e.__handleMySegmentUpdateCall():e.backoff.scheduleCall()})}}},{key:"put",value:function(t,e){t<=this.currentChangeNumber||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.segmentList=e,this.mySegmentsProducer.isSynchronizingMySegments()||this.__handleMySegmentUpdateCall())}}]),n}(),Ri=function(){function r(t,e,n){Object(ht.a)(this,r),this.splitStorage=t,this.splitProducer=e,this.maxChangeNumber=0,this.splitsEventEmitter=n,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new Ii(this.__handleSplitUpdateCall)}return Object(pt.a)(r,[{key:"__handleSplitUpdateCall",value:function(){var t=this;this.maxChangeNumber>this.splitStorage.getChangeNumber()&&(this.handleNewEvent=!1,this.splitProducer.synchronizeSplits(!0).then(function(){t.handleNewEvent?t.__handleSplitUpdateCall():(t.splitProducer.synchronizeSegment&&t.splitProducer.synchronizeSegment(void 0,!1,!0),t.backoff.scheduleCall())}))}},{key:"put",value:function(t){t<=this.splitStorage.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitProducer.isSynchronizingSplits()||this.__handleSplitUpdateCall())}},{key:"killSplit",value:function(e,t,n){var r=this;this.splitStorage.killLocally(t,n,e).then(function(t){t&&r.splitsEventEmitter.emit(r.splitsEventEmitter.SDK_SPLITS_ARRIVED,!0),r.put(e)})}}]),r}(),Ci=/^control_/;var Di=function(){function c(t,e,n){var r,i,o,a,s;Object(ht.a)(this,c),this.EventSource=t,this.streamingUrl=e.url("/sse"),this.reopen=this.reopen.bind(this),this.useHeaders=n,this.headers=(i={SplitSDKClientKey:(r=e).core.authorizationKey.slice(-4),SplitSDKVersion:r.version},o=r.runtime,a=o.ip,s=o.hostname,a&&(i.SplitSDKMachineIP=a),s&&(i.SplitSDKMachineName=s),i)}return Object(pt.a)(c,[{key:"setEventHandler",value:function(t){this.handler=t}},{key:"open",value:function(t){this.close(),this.authToken=t;var e=Object.keys(t.channels).map(function(t){var e=Ci.test(t)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(e+t)}).join(","),n="".concat(this.streamingUrl,"?channels=").concat(e,"&accessToken=").concat(t.token,"&v=").concat("1.1","&heartbeats=true");this.connection=new this.EventSource(this.useHeaders?n:n+"&SplitSDKVersion=".concat(this.headers.SplitSDKVersion,"&SplitSDKClientKey=").concat(this.headers.SplitSDKClientKey),this.useHeaders?{headers:this.headers}:void 0),this.handler&&(this.connection.onopen=this.handler.handleOpen,this.connection.onmessage=this.handler.handleMessage,this.connection.onerror=this.handler.handleError)}},{key:"close",value:function(){this.connection&&this.connection.close()}},{key:"reopen",value:function(){this.open(this.authToken)}}],[{key:"getInstance",value:function(t,e){var n=wi();if(n)return new c(n,t,e)}}]),c}(),Mi=600,Pi="PUSH_NONRETRYABLE_ERROR",Li="PUSH_RETRYABLE_ERROR",xi="PUSH_SUBSYSTEM_UP",Ki="PUSH_SUBSYSTEM_DOWN",Fi="MY_SEGMENTS_UPDATE",Ui="SEGMENT_UPDATE",Gi="SPLIT_KILL",Wi="SPLIT_UPDATE",Bi="CONTROL",Hi="OCCUPANCY",Yi={STREAMING_DISABLED:"STREAMING_DISABLED",STREAMING_PAUSED:"STREAMING_PAUSED",STREAMING_RESUMED:"STREAMING_RESUMED"};var zi=[/control_pri$/,/control_sec$/];function Vi(a){var s=zi.map(function(t){return{regex:t,hasPublishers:!0,oTime:-1,cTime:-1}}),c=!0,u=!0;return{handleOpen:function(){a.emit(xi)},isStreamingUp:function(){return u&&c},handleOccupancyEvent:function(t,e,n){for(var r=0;r<s.length;r++){var i=s[r];if(i.regex.test(e)){if(n>i.oTime){i.oTime=n,i.hasPublishers=0!==t;var o=s.some(function(t){return t.hasPublishers});u&&(!o&&c?a.emit(Ki):o&&!c&&a.emit(xi)),c=o}return}}},handleControlEvent:function(t,e,n){for(var r=0;r<s.length;r++){var i=s[r];if(i.regex.test(e))return void(n>i.cTime&&(i.cTime=n,t===Yi.STREAMING_DISABLED?a.emit(Pi):c&&(t===Yi.STREAMING_PAUSED&&u?a.emit(Ki):t!==Yi.STREAMING_RESUMED||u||a.emit(xi)),u=t===Yi.STREAMING_RESUMED))}}}}var qi=Object(T.b)("splitio-sync:sse-handler");function Ji(c){var u=Vi(c);return{handleOpen:function(){u.handleOpen()},handleError:function(t){var e,n=t;try{e=t,Object(R.j)(e.data)&&(e.parsedData=JSON.parse(e.data)),n=e}catch(t){qi.warn("Error parsing SSE error notification: ".concat(t))}var r=n.parsedData&&n.parsedData.message;qi.error("Fail to connect to streaming".concat(r?', with error message: "'.concat(r,'"'):"")),!function(t){if(t.parsedData&&t.parsedData.code){var e=t.parsedData.code;if(40140<=e&&e<=40149)return!0;if(4e4<=e&&e<=49999)return!1}return!0}(n)?c.emit(Pi):c.emit(Li)},handleMessage:function(t){var e,n,r;try{n=t,(r=JSON.parse(n.data)).parsedData=JSON.parse(r.data),r.name&&"[meta]occupancy"===r.name&&(r.parsedData.type=Hi),e=r}catch(t){return void qi.warn("Error parsing new SSE message notification: ".concat(t))}var i=e.parsedData,o=e.data,a=e.channel,s=e.timestamp;if(qi.debug("New SSE message received, with data: ".concat(o,".")),u.isStreamingUp()||i.type===Hi||i.type===Bi)switch(i.type){case Wi:c.emit(Wi,i.changeNumber);break;case Ui:c.emit(Ui,i.changeNumber,i.segmentName);break;case Fi:c.emit(Fi,i,a);break;case Gi:c.emit(Gi,i.changeNumber,i.splitName,i.defaultTreatment);break;case Hi:u.handleOccupancyEvent(i.metrics.publishers,a,s);break;case Bi:u.handleControlEvent(i.controlType,a,s)}}}}function Qi(t){return e=ar.hash(t,0).toString(),btoa(e);var e}var $i=Object(T.b)("splitio-sync:push-manager");function Xi(o,a){if(t=$i,wi()?"function"==typeof atob&&"function"==typeof btoa||(t.warn('"atob" and "btoa" functions for Base64 encoding are not available. Falling back to polling mode.'),0):(t.warn("EventSource API is not available. Falling back to polling mode."),0)){var t,r=new qt.a,e=o.get(o.constants.READINESS).splits,i=o.get(o.constants.SETTINGS),n=o.get(o.constants.STORAGE),s=Di.getInstance(i,!a),c=Ji(r);s.setEventHandler(c);var u,l,f={},h=[],p=!1,d=new Ii(y,i.scheduler.pushRetryBackoffBase);r.on(Ki,S),r.on(xi,function(){d.reset()}),r.on(Pi,function(){b(),r.emit(Ki)}),r.on(Li,function(){s.close();var t=d.scheduleCall();$i.info("Attempting to reconnect in ".concat(t/1e3," seconds.")),r.emit(Ki)});var v=o.get(o.constants.PRODUCER),g=new Ri(n.splits,v,e);if(h.push(g),r.on(Gi,g.killSplit),r.on(Wi,g.put),a)r.on(Fi,function(t,e){var n=e.split("_")[2],r=f[n];if(r&&a[r]){var i=a[r].get(o.constants.MY_SEGMENTS_CHANGE_WORKER,!0);i&&i.put(t.changeNumber,t.includesPayload?t.segmentList?t.segmentList:[]:void 0)}});else{var m=new ji(n.segments,v);h.push(m),r.on(Ui,m.put)}return j()(Object.create(r),{stop:b,start:y,startNewClient:function(t,e){var n=Qi(t),r=e.get(e.constants.STORAGE),i=e.get(e.constants.PRODUCER);f[n]||(f[n]=t,p=!0);var o=new ji(r.segments,i);h.push(o),e.put(e.constants.MY_SEGMENTS_CHANGE_WORKER,o),setTimeout(function(){p&&(p=!1,y())},0)},removeClient:function(t){var e=Qi(t);delete f[e]}})}function y(){u=!1,$i.info("Connecting to push streaming.");var n=a?Object.keys(a):void 0;Ai(i,n).then(function(t){if(!u){if(!t.pushEnabled)return $i.info("Streaming is not available. Switching to polling mode."),void r.emit(Pi);if(!(n&&n.length<Object.keys(a).length)){var e=t.decodedToken;s.open(t),function(t,e){l&&clearTimeout(l);var n=e-t-Mi;$i.info("Refreshing streaming token in ".concat(n," seconds.")),l=setTimeout(y,1e3*n)}(e.iat,e.exp)}}}).catch(function(t){u||($i.error("Failed to authenticate for streaming. Error: ".concat(t.message,".")),400<=t.statusCode&&t.statusCode<500?r.emit(Pi):r.emit(Li))})}function b(){s.close(),u=!0,$i.info("Disconnecting from push streaming."),l&&clearTimeout(l),d.reset(),S()}function S(){h.forEach(function(t){return t.backoff.reset()})}}var Zi=Object(T.b)("splitio-producer:task"),to=function(e,t){var n=Object(R.f)(e),r=!1;return{start:function(){r||(Zi.debug("Starting ".concat(n," refreshing each ").concat(t)),r=Vr(function(t){Zi.debug("Running ".concat(n)),e().then(function(){return t()})},t))},stop:function(){Zi.debug("Stopping ".concat(n)),r&&r(),r=!1},isRunning:function(){return!!r}}};var eo=function(t,i){return t<1?i:new Promise(function(e,n){var r=setTimeout(function(){n(new Zr("Operation timed out because it exceeded the configured time limit of ".concat(t,"ms.")))},t);i.then(function(t){clearTimeout(r),e(t)},function(t){clearTimeout(r),n(t)})})},no=ni;var ro=function(t,e){var n,r,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length?arguments[3]:void 0,a=4<arguments.length?arguments[4]:void 0,s=5<arguments.length?arguments[5]:void 0,c=t.sync.__splitFiltersValidation.queryString,u=no((n=c,r=s,ii(t,"/splitChanges?since=".concat(e).concat(n||""),void 0,r?oi:void 0))),l=i||a;return u=Ue.start(Ue.TaskNames.SPLITS_FETCH,!!l&&o,u),i&&(u=eo(t.startup.requestTimeoutBeforeReady,u)),u.then(function(t){return t.json().catch(function(t){throw new Xr(t.message)})})},io=function(t){var r=new ze;return t.forEach(function(t){t.matcherGroup.matchers.forEach(function(t){var e=t.matcherType,n=t.userDefinedSegmentMatcherData;"IN_SEGMENT"===e&&r.add(n.segmentName)})}),r},oo=Object(T.b)("splitio-producer:split-changes");function ao(t,e){var a=1<arguments.length&&void 0!==e&&e,n=t.getAll(),s=n[t.constants.SETTINGS],r=n[t.constants.READINESS],c=n[t.constants.STORAGE],u=n[t.constants.COLLECTORS],l=r.splits,f=!0,h=!0;return function e(t,n){var r=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length?n:void 0;var i=c.splits.getChangeNumber();return(S(i)?i:Promise.resolve(i)).then(function(i){oo.debug("Spin up split update using since = ".concat(i));var t=ro(s,i,f,u,a,o).then(function(t){f=!1;var e,n,r=(e=t.splits,(n=e.reduce(function(e,t){return"ACTIVE"===t.status?(e.added.push([t.name,JSON.stringify(t)]),io(t.conditions).forEach(function(t){e.segments.add(t)})):e.removed.push(t.name),e},{added:[],removed:[],segments:new ze})).segments=Ye(n.segments),n);return oo.debug("New splits ".concat(r.added.length)),oo.debug("Removed splits ".concat(r.removed.length)),oo.debug("Segment names collected ".concat(r.segments)),Promise.all([c.splits.setChangeNumber(t.till),c.splits.addSplits(r.added),c.splits.removeSplits(r.removed),c.segments.registerSegments(r.segments)]).then(function(){var e;!h&&(i===t.till||a&&!(e=c.segments).getRegisteredSegments().every(function(t){return-1!==e.getChangeNumber(t)}))||(h=!1,l.emit(l.SDK_SPLITS_ARRIVED))})}).catch(function(t){return t instanceof Xr||(setTimeout(function(){throw t},0),f=!1),oo.warn("Error while doing fetch of Splits. ".concat(t)),f&&s.startup.retriesOnFailureBeforeReady>r?(r+=1,oo.info("Retrying download of splits #".concat(r,". Reason: ").concat(t)),e(r,o)):f=!1});return f&&c.splits.checkCache()&&l.emit(l.SDK_SPLITS_CACHE_LOADED),t})}}var so=ni;var co=function(t,e,n,r){var i,o,a=1<arguments.length&&void 0!==e&&e,s=2<arguments.length?n:void 0,c=so((o=3<arguments.length?r:void 0,ii(i=t,"/mySegments/".concat(encodeURIComponent(Wt(i.core.key))),void 0,o?oi:void 0)));return c=Ue.start(Ue.TaskNames.MY_SEGMENTS_FETCH,!!a&&s,c),a&&(c=eo(t.startup.requestTimeoutBeforeReady,c)),c.then(function(t){return t.json().catch(function(t){throw new Xr(t.message)})}).then(function(t){return t.mySegments.map(function(t){return t.name})})},uo=Object(T.b)("splitio-producer:my-segments");var lo=Object(T.b)("splitio-producer:mySegmentsHandler"),fo=function(t){var e,n,s,r,i,c,o,a,u,l=t.get(t.constants.SETTINGS),f=t.get(t.constants.STORAGE).splits,h=t.get(t.constants.READINESS),p=h.splits,d=h.segments,v=(n=(e=t).getAll(),s=n[e.constants.SETTINGS],r=n[e.constants.READINESS],i=n[e.constants.STORAGE],c=n[e.constants.COLLECTORS],o=r.segments,u=a=!0,function e(t,n,r){var i=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length?n:void 0,a=2<arguments.length?r:void 0;return(o?new Promise(function(t){g(o),t()}):co(s,u,c,a).then(function(t){u=!1,g(t)})).catch(function(t){return t instanceof Xr||setTimeout(function(){throw t},0),u&&s.startup.retriesOnFailureBeforeReady>i?(i+=1,uo.warn("Retrying download of segments #".concat(i,". Reason: ").concat(t)),e(i)):u=!1})});function g(t){var e=i.segments.resetSegments(t);i.splits.usesSegments()&&(e||a)&&(a=!1,o.emit(o.SDK_SEGMENTS_ARRIVED))}var m=to(b,l.scheduler.segmentsRefreshRate);p.on(p.SDK_SPLITS_ARRIVED,function(){if(!S)return;var t=f.usesSegments();t!==m.isRunning()&&(lo.info("Turning segments data polling ".concat(t?"ON":"OFF",".")),t?m.start():m.stop())}),f.usesSegments()?p.once(p.SDK_SPLITS_ARRIVED,T):setTimeout(T,0);var y=!1;function b(t,e){return y=!0,v(0,t,e).then(function(t){return y=!1,t})}var S=!1;function T(){t.get(t.constants.READY,!0)||f.usesSegments()||d.emit(d.SDK_SEGMENTS_ARRIVED)}return{start:function(){S=!0,f.usesSegments()&&m.start()},stop:function(){S=!1,m.stop()},isRunning:function(){return S},isSynchronizingMySegments:function(){return y},synchronizeMySegments:b}},ho=Object(T.b)("splitio-producer:updater"),po=function(t){var e=t.get(t.constants.SETTINGS),n=ao(t),r=to(a,e.scheduler.featuresRefreshRate),i=fo(t),o=!1;function a(t){return o=!0,n(0,t).then(function(t){return o=!1,t})}return{start:function(){ho.info("Starting BROWSER producer"),r.start(),i.start()},stop:function(){ho.info("Stopping BROWSER producer"),r.stop(),i.stop()},isRunning:r.isRunning,isSynchronizingSplits:function(){return o},synchronizeSplits:a,isSynchronizingMySegments:i.isSynchronizingMySegments,synchronizeMySegments:i.synchronizeMySegments}},vo=Object(T.b)("splitio-sync:sync-manager");var go=Object(T.b)("splitio-client:cleanup"),mo=function(){function n(t,e){Object(ht.a)(this,n),this.storage=t.get(t.constants.STORAGE),this.settings=t.get(t.constants.SETTINGS),this.syncManager=e,this.flushData=this.flushData.bind(this),this.settings.sync.impressionsMode===et&&(this.impressionsCounter=t.get(t.constants.IMPRESSIONS_COUNTER))}return Object(pt.a)(n,[{key:"start",value:function(){"undefined"!=typeof window&&window.addEventListener&&(go.debug("Registering flush handler when unload page event is triggered."),window.addEventListener("unload",this.flushData))}},{key:"stop",value:function(){"undefined"!=typeof window&&window.removeEventListener&&(go.debug("Deregistering flush handler when unload page event is triggered."),window.removeEventListener("unload",this.flushData))}},{key:"flushData",value:function(){this._flushImpressions(),this._flushEvents(),this.impressionsCounter&&this._flushImpressionsCount(),this.syncManager&&this.syncManager.pushManager&&this.syncManager.pushManager.stop()}},{key:"_flushImpressions",value:function(){var t=this.storage.impressions;if(!t.isEmpty()){var e=this.settings.url("/testImpressions/beacon"),n=ui(t,this.settings),r={sim:this.settings.sync.impressionsMode===et?et:tt};this._sendBeacon(e,n,r)||ai(si(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_flushImpressionsCount",value:function(){var t={pf:li(this.impressionsCounter)};if(0!==t.pf.length){var e=this.settings.url("/testImpressions/count/beacon");this._sendBeacon(e,t)||ai(ci(this.settings,{body:JSON.stringify(t)}))}}},{key:"_flushEvents",value:function(){var t=this.storage.events;if(!t.isEmpty()){var e=this.settings.url("/events/beacon"),n=t.toJSON();this._sendBeacon(e,n)||bi(Si(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_sendBeacon",value:function(t,e,n){if("undefined"!=typeof navigator&&navigator.sendBeacon){var r={entries:e,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&j()(r,n);var i=JSON.stringify(r);return navigator.sendBeacon(t,i)}return!1}}]),n}(),yo={};var bo=function(t,e,n){var r,i,o,a,s,c,u,l=!!n,f=t.get(t.constants.SETTINGS),h=t.get(t.constants.READINESS),p=t.get(t.constants.STORAGE),d=t.get(t.constants.STATUS_MANAGER),v=h.gate,g=h.splits,m=h.segments,y=v.SDK_READY,b=l?void 0:yi(t),S=l?void 0:Ei(t);switch(f.mode){case B:case W:t.put(t.constants.COLLECTORS,b&&b.collectors),l?r=yo[f.core.authorizationKey].shared(t):(o={},a=(i=t).get(i.constants.SETTINGS),s=_(!1,i),c=a.streamingEnabled?Xi(i,o):void 0,u=i.get(i.constants.PRODUCER),s.shared=_.bind(null,!0),s.pushManager=c,r=s,yo[f.core.authorizationKey]=r);break;case H:t.put(t.constants.READY_FROM_CACHE,!0)}function T(){u.isRunning()?vo.info("Streaming couldn't connect. Continue periodic fetch of data."):(vo.info("Streaming not available. Starting periodic fetch of data."),Object(R.d)(o,function(t){t.get(t.constants.PRODUCER).start()}))}function E(){u.isRunning()&&(vo.info("PUSH (re)connected. Syncing and stopping periodic fetch of data."),Object(R.d)(o,function(t){t.get(t.constants.PRODUCER).stop()})),O()}function O(){i.get(i.constants.PRODUCER).synchronizeSplits(),Object(R.d)(o,function(t){t.get(t.constants.PRODUCER).synchronizeMySegments()})}function _(t,e){var n=t?fo(e):po(e),r=e.get(e.constants.SETTINGS),i=Object(R.q)(Wt(r.core.key));return e.put(e.constants.PRODUCER,n),o[i]&&vo.warn("A client with the same user key has already been created. Only the new instance will be properly synchronized."),o[i]=e,{start:function(){c?(t?u.isRunning()?n.start():n.synchronizeMySegments():(O(),c.on(xi,E),c.on(Ki,T)),c.startNewClient(i,e)):n.start()},stop:function(){o[i]&&(delete o[i],c&&(c.removeClient(i),t||c.stop()),n.isRunning()&&n.stop())}}}var k=l?void 0:new mo(t,r);if(e&&r&&!l){var A=e.sdkReadyTracker,w=e.splitsReadyTracker,N=e.segmentsReadyTracker;A.setCollectorForTask(b.collectors),v.once(y,A),g.once(g.SDK_SPLITS_ARRIVED,w),m.once(m.SDK_SEGMENTS_ARRIVED,N)}r&&r.start(),b&&b.start(),S&&t.put(t.constants.EVENTS,S)&&S.start(),t.put(t.constants.COLLECTORS,n);var I=j()(Object.create(d),zr(t),{destroy:function(){return r&&r.stop(),b&&b.stop(),S&&S.stop(),Promise.all([b&&b.flush(),S&&S.flush()]).then(function(){h.destroy(),k&&k.stop(),p.destroy&&p.destroy(),t.put(t.constants.DESTROYED,!0),l||(C(f.core.authorizationKey),delete yo[f.core.authorizationKey])})}});return l||k.start(I.destroy),{api:I,metricCollectors:b&&b.collectors}};function So(){var s={emptyMock:1};function n(a){var t=Object.keys(a);return t.length!==Object.keys(s).length?(s=a,!0):t.some(function(t){var e,n,r=!s[t],i=(e=s[t],n=a[t],Object(Ie.a)(e)!==Object(Ie.a)(n)||("string"==typeof e?e!==n:e.treatment!==n.treatment||e.config!==n.config)),o=r||i;return o&&(s=a),o})}return function(t){var e=t.features||{};if(!n(e))return!1;var s={};return Object(R.d)(e,function(t,e){var n=t,r=null;Object(R.i)(t)&&(n=t.treatment,r=t.config||r);var i,o,a={};null!==r&&(a[n]=r),s[e]={conditions:[(o=(i={treatment:n}).treatment,i.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:Object(R.j)(i.keys)?[i.keys]:i.keys}}]},partitions:[{treatment:o,size:100}],label:"whitelisted ".concat(o)}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:o,size:100}],label:"default rule"})],configurations:a}}),s}}var To=Object(T.b)("splitio-producer:offline");var Eo=function(r,t){var e=t.getAll(),i=e[t.constants.SETTINGS],o=e[t.constants.READINESS],a=e[t.constants.STORAGE],s=!0;return function(){var n=[],e=null,t={};try{t=r(i)}catch(t){e=t,To.error("There was an issue loading the mock Splits data, no changes will be applied to the current cache. ".concat(t))}return!e&&t?(To.debug("Splits data: "),To.debug(JSON.stringify(t)),Object(R.d)(t,function(t,e){n.push([e,JSON.stringify({name:e,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:"control",conditions:t.conditions||[],configurations:t.configurations,trafficTypeName:t.trafficTypeName})])}),Promise.all([a.splits.flush(),a.splits.addSplits(n)]).then(function(){o.splits.emit(o.splits.SDK_SPLITS_ARRIVED),s&&(s=!1,o.segments.emit(o.segments.SDK_SEGMENTS_ARRIVED))})):Promise.resolve()}};var Oo=function(t){var e,n,r=t.get(t.constants.SETTINGS),i=(e=t,n=So(),Eo(n,e));return to(i,r.scheduler.offlineRefreshRate)};var _o=function(t,e){var n=!e,r=t.get(t.constants.READINESS),i=t.get(t.constants.STORAGE),o=t.get(t.constants.STATUS_MANAGER);n&&setTimeout(function(){r.splits.on(r.splits.SDK_SPLITS_ARRIVED,function(){r.gate.emit(r.gate.SDK_UPDATE)}),r.gate.emit(r.gate.SDK_READY)},0);var a=n?void 0:Oo(t);return a&&a.start(),{api:j()(Object.create(o),zr(t),{destroy:function(){return a&&a.stop(),r.destroy(),i.destroy&&i.destroy(),t.put(t.constants.DESTROYED,!0),n||C(),Promise.resolve()}}),metricCollectors:!1}};function ko(t,a){var s=!1,c=!1;var e=function r(n){var i=new Promise(function(t,e){return n.then(t,function(t){c?e(t):a(t)})}),o=i.then;return Object.defineProperty(i,"then",{value:function(t,e){var n=o.call(i,t,e);return"function"==typeof t&&(s=!0),"function"==typeof e?(c=!0,n):r(n)}}),i}(t);return e.hasOnFulfilled=function(){return s},e}var Ao=Object(T.b)(""),wo="newListener",No="removeListener";function Io(t){Ao.error(t)}function jo(n,t){var r=1<arguments.length&&void 0!==t?t:0,i=n.get(n.constants.READINESS).gate,o=0,a=!1,s=!1,c=i.SDK_READY,e=i.SDK_READY_FROM_CACHE,u=i.SDK_UPDATE,l=i.SDK_READY_TIMED_OUT;i.on(No,function(t){t===c&&o--}),i.on(wo,function(t){t!==c&&t!==l||(a?Ao.error("A listener was added for ".concat(t===c?"SDK_READY":"SDK_READY_TIMED_OUT"," on the SDK, which has already fired and won't be emitted again. The callback won't be executed.")):t===c&&o++)});var f,h=f=ko(new Promise(function(t,e){i.once(c,function(){Ao.info("Split SDK is ready."),o!==r||f.hasOnFulfilled()||Ao.warn("No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."),n.put(n.constants.READY,!0),a=!0,t()}),i.once(l,function(t){n.put(n.constants.HAS_TIMEDOUT,!0),s=!0,e(t)})}),Io);return i.once(e,function(){Ao.info("Split SDK is ready from cache."),n.put(n.constants.READY_FROM_CACHE,!0)}),j()(Object.create(i),{Event:{SDK_READY:c,SDK_READY_FROM_CACHE:e,SDK_UPDATE:u,SDK_READY_TIMED_OUT:l},ready:function(){return s?a?Promise.resolve():ko(Promise.reject("Split SDK has emitted SDK_READY_TIMED_OUT event."),Io):h},__context:n})}var Ro="splitio-ga-to-split",Co=Ro+":mapper",Do=Object(T.b)(Ro);var Mo,Po=(Mo={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(t){var e=t.get("hitType"),n=t.get(Mo.eventTypeId[e]||"hitType"),r=t.get(Mo.eventValue[e]),i={},o=Mo.eventProperties[e];if(o)for(var a=0;a<o.length;a++)i[o[a]]=t.get(o[a]);return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});var Lo=/^[^a-zA-Z0-9]+/,xo=/[^-_.:a-zA-Z0-9]+/g;var Ko=function(c,u,t){var e,n,r,l={prefix:"ga",identities:t.key&&t.trafficType?[{key:t.key,trafficType:t.trafficType}]:void 0};e="splitTracker",n=function t(e,n){Object(ht.a)(this,t);var r=j()({},l,c,n);this.tracker=e;var i,o=(i=r.identities,Array.isArray(i)?Object(R.r)(i).filter(function(t){if(!t)return!1;var e=t.key,n=t.trafficType;return!(!Object(R.j)(e)&&!Object(R.l)(e)||!Object(R.j)(n))}):[]);if(0!==o.length){var a=o.length-r.identities.length;a&&Do.warn("".concat(a," identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),r.identities=o,Object(R.j)(r.prefix)||(Do.warn("The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),r.prefix=void 0);var s=e.get("sendHitTask");e.set("sendHitTask",function(t){if(s(t),!1!==r.hits&&!t.get("splitHit")){try{if(r.filter&&!r.filter(t))return}catch(t){return void Do.warn("GaToSplit custom filter threw: ".concat(t))}var e,n=Po(t);if(r.mapper){try{n=r.mapper(t,n)}catch(t){return void Do.warn("GaToSplit custom mapper threw: ".concat(t))}if(!n)return}if(r.prefix&&(n.eventTypeId="".concat(r.prefix,".").concat(n.eventTypeId)),n.eventTypeId=function(t){if(!Object(R.j)(t)||0===t.length)return t;var e=t.replace(Lo,"").replace(xo,"_"),n=e.slice(0,80);return n.length<e.length&&Do.warn("EventTypeId was truncated because it cannot be more than 80 characters long."),n}(n.eventTypeId),!(!_((e=n).eventTypeId,Co)||!1===k(e.value,Co)||!1===w(e.properties,Co).properties||e.timestamp&&!Object(R.l)(e.timestamp)||e.key&&!1===I(e.key,Co)||e.trafficTypeName&&!1===it(e.trafficTypeName,Co)))n.key&&n.trafficTypeName?u.events.track(n):r.identities.forEach(function(t){var e=j()({key:t.key,trafficTypeName:t.trafficType},n);u.events.track(e)})}}),Do.info("Started GA-to-Split integration")}else Do.warn("No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")},r=window.GoogleAnalyticsObject||"ga",window[r]=window[r]||function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(window[r].q=window[r].q||[]).push(e)},window[r]("provide",e,n)},Fo=Object(T.b)("splitio-split-to-ga"),Uo=function(){function e(t){if(Object(ht.a)(this,e),"function"!=typeof e.getGa())return Fo.warn("`ga` command queue not found. No hits will be sent."),{};this.trackerNames=e.defaultTrackerNames,t&&("function"==typeof t.filter&&(this.filter=t.filter),"function"==typeof t.mapper&&(this.mapper=t.mapper),Array.isArray(t.trackerNames)&&(this.trackerNames=Object(R.s)(t.trackerNames)),this.impressions=t.impressions,this.events=t.events),Fo.info("Started Split-to-GA integration")}return Object(pt.a)(e,[{key:"queue",value:function(t){var n=e.getGa();if(n){if(!1===this.impressions&&t.type===$)return;if(!1===this.events&&t.type===X)return;var r;try{if(this.filter&&!this.filter(t))return;if(r=e.defaultMapper(t),this.mapper&&(!(r=this.mapper(t,r))||!e.validateFieldsObject(r)))return}catch(t){return void Fo.warn("SplitToGa queue method threw: ".concat(t,". No hit was sent."))}this.trackerNames.forEach(function(t){var e=t?"".concat(t,".send"):"send";r.splitHit=!0,n(e,r)})}}}],[{key:"defaultMapper",value:function(t){var e=t.type,n=t.payload;switch(e){case $:return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case X:return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}return null}},{key:"getGa",value:function(){return"undefined"!=typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0}},{key:"validateFieldsObject",value:function(t){return!(!t||!t.hitType)||(Fo.warn("your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)}}]),e}();Uo.defaultTrackerNames=[""];var Go=Uo,Wo=function(i){var o=i.get(i.constants.SETTINGS),a=[];if(o.integrations.forEach(function(t){var e;switch(t.type){case J:var n=i.get(i.constants.STORAGE),r=o.core;e=Ko(t,n,r);break;case Q:e=new Go(t)}e&&e.queue&&a.push(e)}),0!==a.length)return{handleImpression:function(e){a.forEach(function(t){return t.queue({type:$,payload:e})})},handleEvent:function(e){a.forEach(function(t){return t.queue({type:X,payload:e})})}}},Bo=function(){function t(){Object(ht.a)(this,t),this.cache={}}return Object(pt.a)(t,[{key:"_makeKey",value:function(t,e){return"".concat(t,"::").concat(xr(e))}},{key:"inc",value:function(t,e,n){var r=this._makeKey(t,e),i=this.cache[r];this.cache[r]=i?i+n:n}},{key:"popAll",value:function(){var t={};return j()(t,this.cache),this.cache={},t}},{key:"size",value:function(){return Object.keys(this.cache).length}}]),t}(),Ho=Object(T.b)("splitio"),Yo=function(t,e){return"".concat(t.matchingKey?t.matchingKey:t,"-").concat(t.bucketingKey?t.bucketingKey:t,"-").concat(void 0!==e?e:"")};function zo(t){var e,n,c={},r={splitsReadyTracker:Ue.start(Ue.TaskNames.SPLITS_READY),segmentsReadyTracker:Ue.start(Ue.TaskNames.SEGMENTS_READY),sdkReadyTracker:Ue.start(Ue.TaskNames.SDK_READY)},u=new ke,l=Oe(t);u.put(u.constants.SETTINGS,l),e=l.core.authorizationKey,n=!1,null==e?E.error("Factory instantiation: you passed a null or undefined api_key, api_key must be a non-empty string."):Object(R.j)(e)?0<e.length?n=e:E.error("Factory instantiation: you passed an empty api_key, api_key must be a non-empty string."):E.error("Factory instantiation: you passed an invalid api_key, api_key must be a non-empty string."),n&&(O[n]?(E.warn("Factory instantiation: You already have ".concat(O[n]," ").concat(1===O[n]?"factory":"factories"," with this API Key. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")),O[n]++):(O[n]=1)<Object.keys(O).length&&E.warn("Factory instantiation: You already have an instance of the Split factory. Make sure you definitely want this additional instance. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application."));var f=re(),i=f(l.startup.readyTimeout);u.put(u.constants.READINESS,i);var o=jo(u);u.put(u.constants.STATUS_MANAGER,o);var h=zt(u);u.put(u.constants.STORAGE,h);var p=new Bo;u.put(u.constants.IMPRESSIONS_COUNTER,p);var a=Wo(u);u.put(u.constants.INTEGRATIONS_MANAGER,a);var d=l.mode===G?_o:bo,s=d(u,r),v=s.api,g=s.metricCollectors,m=ft(h.splits,u),y=Ae(l.core.key),b=Yo(y,l.core.trafficType);return c[b]=v,Ho.info("New Split SDK instance created."),{client:function(t,e){if(void 0===t)return Ho.debug("Retrieving default SDK client."),v;if("function"!=typeof h.shared)throw new Error("Shared Client not supported by the storage mechanism. Create isolated instances instead.");var n,r=I(t,"Shared Client instantiation");if(!1===r)throw new Error("Shared Client needs a valid key.");if(void 0!==e&&!1===(n=it(e,"Shared Client instantiation")))throw new Error("Shared Client needs a valid traffic type or no traffic type at all.");var i=Yo(r,n);if(c[i])Ho.debug("Retrieving existing SDK client.");else{var o=l.overrideKeyAndTT(r,n),a=new ke,s=f(o.startup.readyTimeout);a.put(u.constants.READY_FROM_CACHE,u.get(u.constants.READY_FROM_CACHE,!0)),a.put(u.constants.READINESS,s),a.put(u.constants.STATUS_MANAGER,jo(a,-1)),a.put(u.constants.SETTINGS,o),a.put(u.constants.STORAGE,h.shared(o)),a.put(u.constants.IMPRESSIONS_COUNTER,p),c[i]=d(a,!1,g).api,Ho.info("New shared client instance created.")}return c[i]},manager:function(){return Ho.info("Manager instance retrieved."),m},Logger:T.a,settings:l}}function Vo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return qo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Jo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Qo=function(){function d(t){var e=this,n=t.splitioOptions,r=t.app,i=t.subject,c=t.splitioClients,o=t.splitioManager,a=t.preloadExists,s=t.usePreload,u=void 0===s||s,l=t.windowOverride,f=void 0===l?window:l;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var h,p=Object.entries(i)[0];n.core.key=Object(y.getSubjectKey)({id:p[1],idType:p[0]}),n.storage={type:u?"LOCALSTORAGE":"MEMORY",prefix:"".concat(r)},n.streamingEnabled=!1,c&&o||(h=zo(n)),c||Object.entries(i).forEach(function(t,e){var n,r,i,o=Vo(t,2),a=o[0],s=o[1];0===e?(n={},r=a,i=h.client(),r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,c=n):c[a]=h.client(Object(y.getSubjectKey)({id:s,idType:a}))}),o=o||h.manager(),this._splitioClients=c,this._splitioManager=o,this._clientsReady=Promise.all(Object.values(this._splitioClients).map(function(e){return new Promise(function(t){return e.on(a?e.Event.SDK_READY_FROM_CACHE:e.Event.SDK_READY,t)})})),this._managerReady=new Promise(function(t){return e._splitioManager.on(a?e._splitioManager.Event.SDK_READY_FROM_CACHE:e._splitioManager.Event.SDK_READY,t)}),this._allReady=Promise.all([this._clientsReady,this._managerReady]),u||this._clearLocalStorage({app:r,windowOverride:f})}var t,e,n;return t=d,(e=[{key:"_clearLocalStorage",value:function(t){var e=this,n=t.app,r=t.windowOverride;this._splitioManager.on(this._splitioManager.Event.SDK_READY,function(){e._splitioManager.splits().forEach(function(t){return r.localStorage.removeItem("".concat(n,".SPLITIO.split.").concat(t.name))}),r.localStorage.removeItem("".concat(n,".SPLITIO.splits.lastUpdated")),r.localStorage.removeItem("".concat(n,".SPLITIO.splits.till")),r.localStorage.removeItem("".concat(n,".SPLITIO.splits.usingSegments"))})}},{key:"ready",get:function(){return this._allReady}},{key:"getCohortAllocations",value:function(t){var e=t.idType,n=t.experiments,r=void 0===n?[]:n,i=t.attributes,o=void 0===i?{}:i,a=this._splitioClients[e].getTreatmentsWithConfig(r,o);return Object(y.treatmentsToCohortAllocations)(a)}},{key:"getExperimentsById",value:function(t){var e=this,i=t.map(function(t){return e._splitioManager.split(t)});return t.reduce(function(t,e,n){var r=i[n];return null!==r&&(t[e]=Object(y.transformSplitToExperiment)(r)),t},{})}},{key:"getExperiments",value:function(){return this._splitioManager.splits().reduce(function(t,e){return t[e.name]=Object(y.transformSplitToExperiment)(e),t},{})}},{key:"destroy",value:function(){var r=this;return Promise.all(Object.entries(this._splitioClients).map(function(t){var e=Vo(t,2),n=e[0];e[1].destroy().then(function(){delete r._splitioClients[n]})}))}}])&&Jo(t.prototype,e),n&&Jo(t,n),d}();function $o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$o(Object(n),!0).forEach(function(t){Zo(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Zo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ta(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ea(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ea(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ea(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function na(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ra=function(){function v(t){var i=this,e=t.app,n=t.splitioWrapper,r=t.splitioOptions,o=t.subject,a=t.loadLocalStorage,s=void 0===a?g:a,c=t.readyTimeout,u=void 0===c?3e3:c,l=t.mockData,f=t.preloadLocation,h=t.usePreload,p=void 0===h||h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v),Object(y.validateApp)(e),this._app=e,this._readyTimeout=u;var d=!1;p&&Object.entries(o).forEach(function(t){var e=ta(t,2),n=e[0],r=e[1];d=s({app:i._app,idType:n,id:r,preloadLocation:f})}),this._subject=o,l&&(n=this._getMockWrapper(l,o)),n?this._splitioWrapper=n:0!==Object.keys(o).length&&(this._splitioWrapper=new Qo({app:this._app,subject:o,splitioOptions:r,preloadExists:d,usePreload:p})),this._ready=new Promise(function(e){return Promise.race([i._splitioWrapper?i._splitioWrapper.ready:new Promise(function(t){return t()}),new Promise(function(t,e){return setTimeout(function(){return e(new Error("timeout"))},i._readyTimeout)})]).then(e).catch(function(t){console.log("Hivemind Client not ready from cache. Will return default values.",t),e("timeout")})})}var t,e,n;return t=v,(e=[{key:"ready",get:function(){return this._ready}},{key:"setMockData",value:function(t){this._splitioWrapper=this._getMockWrapper(t)}},{key:"_getMockWrapper",value:function(t){return new y.MockWrapper({mockData:t})}},{key:"getCohorts",value:function(t){var e=t.experiments,n=void 0===e?[]:e,r=t.labels,i=void 0===r?[]:r,o=t.attributes,a=void 0===o?{}:o,s=t.windowOverride,c=void 0===s?window:s;if(n.length){var u=this._splitioWrapper.getExperimentsById(n);return this._getCohorts({experimentsMetadata:u,experiments:n,attributes:a,windowOverride:c})}if(i.length){var l=this._getExperimentsByLabel(i),f=Object.keys(l);return this._getCohorts({experimentsMetadata:l,experiments:f,attributes:a,windowOverride:c})}return console.log("No experiments or labels provided"),this._getCohorts({attributes:a,windowOverride:c})}},{key:"_getCohorts",value:function(t){var o=this,e=t.experimentsMetadata,n=void 0===e?{}:e,r=t.experiments,i=void 0===r?[]:r,a=t.attributes,s=void 0===a?{}:a,c=t.windowOverride,u=void 0===c?window:c,l=Object(y.groupEligibleExperimentsById)({subject:this._subject,experiments:i,experimentsMetadata:n}),f=l.experimentsByIdType,h=l.ineligibleExperiments,p={};Object.entries(f).forEach(function(t){var e=ta(t,2),n=e[0],r=e[1],i=o._splitioWrapper.getCohortAllocations({idType:n,experiments:r,attributes:s});p=Xo(Xo({},p),i)}),p=Object(y.updateCohortAllocationsWithEid)(p,this._app);var d,v,g=(d=this._subject,v={},Object.entries(d).forEach(function(t){var e=ta(t,2),n=e[0],r=e[1];v[n]=Object(y.getSubjectKey)({idType:n,id:r})}),v);!function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window;for(var r in n._expDataLayer=n._expDataLayer||[],t)"ineligible"!==t[r].cohortId&&n._expDataLayer.push({schema:"add_experiment_assignment",type:"abn",version:"v1",data:{experiment_id:r,variant_id:t[r].error?"error":t[r].cohortId}})}(p,g,u),Object.keys(p).forEach(function(t){return delete p[t].error});var m=Object(y.generateDefaultAllocations)(h);return{cohorts:p=Xo(Xo({},p),m)}}},{key:"getExperiments",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).labels,n=void 0===e?[]:e,r=n.length?this._getExperimentsByLabel(n):this._splitioWrapper.getExperiments();return Object.values(r)}},{key:"_getExperimentsByLabel",value:function(o){var t=this._splitioWrapper.getExperiments();return Object.entries(t).reduce(function(t,e){var n=ta(e,2),r=n[0],i=n[1];return o.every(function(t){return i.labels.includes(t)})&&(t[r]=i),t},{})}},{key:"getParameterValue",value:function(t){var o=t.parameter,e=t.defaultValue,n=t.attributes,r=void 0===n?{}:n,i=t.windowOverride,a=void 0===i?window:i,s=this._getExperimentsByLabel([this._app,y.hivemindConstants.PARAMETER_LABEL]),c=Object.entries(s).reduce(function(t,e){var n=ta(e,2),r=n[0],i=n[1];return Object.values(i.cohortData).some(function(t){return o in t})&&(t[r]=i),t},{}),u=Object.keys(c),l=u.length;if(1!==l)return 1<l&&console.log("Multiple experiments containing the same parameter definition."),{parameterValue:e,cohortId:null,experimentId:null};var f=this._getCohorts({experimentsMetadata:c,experiments:u,attributes:r,windowOverride:a}).cohorts[u[0]],h=f.data;return{parameterValue:o in h?h[o]:e,cohortId:f.cohortId,experimentId:u[0]}}}])&&na(t.prototype,e),n&&na(t,n),v}();function ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ia(Object(n),!0).forEach(function(t){aa(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function aa(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var sa={},ca={dev:"mbqv2tai7f3k04c7rm4dnombdfuvvddtmgku",test:"k0kgs7d57kss5jbkfsdto70ierl2tgvivl0v",prod:"pbqj1rfhsn00ukm2lv96jcg4rmbktkrdsmm0"};function ua(t){var e=t.Client,n=t.app,r=t.env,i=t.shopperId,o=t.visitorGuid,a=t.readyTimeout,s=t.mockData,c=t.usePreload,u="".concat(n).concat(r).concat(i).concat(o).concat(a).concat(!!s).concat(c);return sa[u]||(sa[u]=new e({app:n.replace(/\./g,"-"),splitioOptions:{core:{authorizationKey:ca[r]}},subject:oa(oa({},i&&aa({},y.hivemindConstants.idTypes.SHOPPER_ID,i)),o&&aa({},y.hivemindConstants.idTypes.VISITOR_GUID,o)),preloadLocation:"__hivemindPreload",readyTimeout:a,mockData:s,usePreload:c})),sa[u].ready.then(function(){return sa[u]})}function la(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.readyTimeout,n=t.mockData,r=t.usePreload,i=t.Client,o=void 0===i?ra:i,a=t.initClient,s=void 0===a?ua:a,c=window.ux,u=(c=void 0===c?{}:c).data,l=(u=void 0===u?{}:u).app,f=void 0===l?"default":l,h=u.env,p=void 0===h?"dev":h;Object(m.updateAuthTokens)();var d=Object(m.getShopperId)(),v=Object(b.getVisitorId)(),g={Client:o,app:f,env:p,shopperId:d,visitorGuid:v,readyTimeout:e,mockData:n,usePreload:r};return v?s(g):new Promise(function(n){window._expDataLayer.push({schema:"get_tracking_values",version:"v1",data:{callback:function(t){var e=t.vtg;g.visitorGuid=e,n(s(g))}}})})}e.default=ra}],i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=32);function i(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,r});